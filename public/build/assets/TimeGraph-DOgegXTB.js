import{d as I,r as m,o as P,c as g,q as O,e as N,b as q,f as s,u as Y,h as J,a as r,j as K,g as o,t as f,l as V,m as j,i as Q,F as h,k as b,C as D}from"./app-xW5alZjF.js";import{_ as W}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-D_ormDxu.js";import{a as X}from"./api-Bi5Kuh-G.js";const Z={class:"py-6"},tt={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},et={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},st={class:"border-b border-gray-200 px-6 py-4"},at={class:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between"},nt={class:"mt-1 text-sm text-gray-500"},ot={key:0},rt={key:1},lt={class:"font-mono"},it={class:"flex flex-wrap items-end gap-4"},dt={class:"flex gap-2"},ut=["disabled"],ct=["disabled"],mt={class:"px-6 py-4"},ft={key:0,class:"mb-4 rounded-md bg-red-50 p-4 text-sm text-red-700"},pt={key:1,class:"flex items-center justify-center py-16"},vt={key:2,class:"space-y-6"},gt={key:0,class:"py-10 text-center text-sm text-gray-500"},ht={key:1},bt={class:"mb-3 flex items-center text-xs text-gray-500"},yt={class:"flex-1"},xt={class:"flex justify-between text-[11px] font-medium"},_t={class:"space-y-4"},Dt={class:"w-36 text-sm font-medium text-gray-700"},wt={class:"flex-1"},kt={class:"relative h-12 rounded-md border border-gray-200 bg-gray-50"},St=["title"],$t={class:"truncate"},y=24,Ct=I({__name:"TimeGraph",setup(Tt){const p=m(!0),c=m(null),w=m([]),k=m("Asia/Manila"),v=m({start:"",end:""}),i=m({startDate:"",endDate:""}),S=e=>e.toISOString().slice(0,10),$=()=>{const e=new Date,t=new Date;t.setDate(t.getDate()-4),i.value.startDate=S(t),i.value.endDate=S(e)},x=async()=>{var e,t;p.value=!0,c.value=null;try{const a={};i.value.startDate&&(a.start_date=i.value.startDate),i.value.endDate&&(a.end_date=i.value.endDate);const{data:n}=await X.get("/my/time-graph",{params:a});w.value=n.days||[],k.value=n.timezone||"Asia/Manila",v.value={start:n.start_date,end:n.end_date}}catch(a){console.error(a),c.value=((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.error)||"Unable to load time graph data. Please try again."}finally{p.value=!1}},A=()=>{if(i.value.startDate&&i.value.endDate){const e=new Date(i.value.startDate),t=new Date(i.value.endDate);if(t<e){c.value="End date must be on or after the start date.";return}if((t.getTime()-e.getTime())/(1e3*60*60*24)>30){c.value="Please limit the range to 31 days or less.";return}}x()},B=()=>{$(),x()};P(()=>{$(),x()});const T=e=>{let t=e;for(;t<0;)t+=24;for(;t>=24;)t-=24;return t},M=(e,t)=>{if(t-e>=24)return[{start:0,end:24}];const n=T(e);let l=T(t);return t-e<=0?[{start:n,end:24},{start:0,end:l}]:(l<=n&&t>e&&(l+=24),l>24?[{start:n,end:24},{start:0,end:l-24}]:[{start:n,end:l}])},_=e=>{const t=(e%24+24)%24,a=Math.floor(t),n=Math.round(t%1*60),l=a>=12?"PM":"AM",d=(a+11)%12+1,u=n===0?"00":n.toString().padStart(2,"0");return`${d}:${u} ${l}`},L=g(()=>{const e=[];for(let t=0;t<=y;t+=2)e.push({label:_(t),value:t});return e}),E=e=>{const t=Math.round(e*3600),a=Math.floor(t/3600),n=Math.floor(t%3600/60),l=t%60,d=u=>u<10?`0${u}`:`${u}`;return`${d(a)}:${d(n)}:${d(l)}`},z=g(()=>w.value.map(e=>{const t=e.shift?M(e.shift.start_hour,e.shift.end_hour):[],a=e.tasks.flatMap(n=>M(n.start_hour,n.end_hour).map(d=>{const u=d.end-d.start,U=_(d.start),G=_(d.end);return{...d,title:n.title,tooltip:`${U} - ${G} (Total Time: ${E(u)})`}}));return{...e,shiftSegments:t,taskSegments:a}})),C=e=>{const t=(e.end-e.start)/y*100;return{left:`${e.start/y*100}%`,width:`${Math.max(t,0)}%`}},F=g(()=>{if(!v.value.start||!v.value.end)return"";const e=new Date(v.value.start),t=new Date(v.value.end),a={month:"long",day:"numeric",year:"numeric"};return`${e.toLocaleDateString(void 0,a)} → ${t.toLocaleDateString(void 0,a)}`}),H=g(()=>z.value.some(e=>e.shiftSegments.length>0||e.taskSegments.length>0)),R=g(()=>L.value.map(e=>({...e,style:{left:`${e.value/y*100}%`}})));return(e,t)=>(o(),O(W,null,{header:N(()=>[...t[2]||(t[2]=[s("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Time Graph ",-1)])]),default:N(()=>[q(Y(J),{title:"Time Graph"}),s("div",Z,[s("div",tt,[s("div",et,[s("div",st,[s("div",at,[s("div",null,[t[4]||(t[4]=s("h3",{class:"text-lg font-medium text-gray-900"}," Shift and Task Schedule ",-1)),s("p",nt,[F.value?(o(),r("span",ot,f(F.value),1)):(o(),r("span",rt,"Last 5 days")),t[3]||(t[3]=K(" · Timezone: ",-1)),s("span",lt,f(k.value),1)])]),s("div",it,[s("div",null,[t[5]||(t[5]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Start Date ",-1)),V(s("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=a=>i.value.startDate=a),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[j,i.value.startDate]])]),s("div",null,[t[6]||(t[6]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," End Date ",-1)),V(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=a=>i.value.endDate=a),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[j,i.value.endDate]])]),s("div",dt,[s("button",{type:"button",class:"inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",onClick:A,disabled:p.value}," Apply ",8,ut),s("button",{type:"button",class:"inline-flex items-center rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:B,disabled:p.value}," Reset ",8,ct)])])])]),s("div",mt,[c.value?(o(),r("div",ft,f(c.value),1)):Q("",!0),p.value?(o(),r("div",pt,[...t[7]||(t[7]=[s("div",{class:"inline-block h-10 w-10 animate-spin rounded-full border-b-2 border-indigo-600"},null,-1)])])):(o(),r("div",vt,[H.value?(o(),r("div",ht,[s("div",bt,[t[8]||(t[8]=s("div",{class:"w-36"},null,-1)),s("div",yt,[s("div",xt,[(o(!0),r(h,null,b(L.value,a=>(o(),r("span",{key:a.value},f(a.label),1))),128))])])]),s("div",_t,[(o(!0),r(h,null,b(z.value,a=>(o(),r("div",{key:a.date,class:"flex items-center gap-4"},[s("div",Dt,f(a.label),1),s("div",wt,[s("div",kt,[(o(!0),r(h,null,b(R.value,n=>(o(),r("div",{key:n.value,class:"absolute inset-y-0 border-l border-gray-200 last:border-r-0",style:D(n.style)},null,4))),128)),(o(!0),r(h,null,b(a.shiftSegments,(n,l)=>(o(),r("div",{key:`shift-${a.date}-${l}`,class:"absolute inset-y-3 rounded-md bg-sky-200/70 border border-sky-400",style:D(C(n))},null,4))),128)),(o(!0),r(h,null,b(a.taskSegments,(n,l)=>(o(),r("div",{key:`task-${a.date}-${l}`,class:"absolute inset-1 rounded-md bg-emerald-400 border border-emerald-600 text-[11px] font-medium text-emerald-900 flex items-center justify-center px-2 shadow",style:D(C(n)),title:n.tooltip},[s("span",$t,f(n.title),1)],12,St))),128))])])]))),128))])])):(o(),r("div",gt," No shift or task data for this period. ")),t[9]||(t[9]=s("div",{class:"flex items-center gap-4 text-sm text-gray-600"},[s("div",{class:"flex items-center gap-2"},[s("span",{class:"inline-block h-3 w-6 rounded-sm bg-sky-400 border border-sky-600"}),s("span",null,"Shift")]),s("div",{class:"flex items-center gap-2"},[s("span",{class:"inline-block h-3 w-6 rounded-sm bg-emerald-500 border border-emerald-700"}),s("span",null,"Task")])],-1))]))])])])])]),_:1}))}});export{Ct as default};
