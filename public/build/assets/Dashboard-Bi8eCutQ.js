import{_ as yt}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-BJgGdAQy.js";import{d as ht,r as p,q as _,o as mt,z as gt,c as l,a as J,u as vt,h as _t,w as K,b as e,e as C,t as i,f as r,n as V,k as kt,F as D,i as I}from"./app-BH-Xrb5w.js";import{a as y}from"./api-BvJpXU-0.js";const ft={class:"py-12"},wt={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},bt={class:"mb-6 grid gap-4 md:grid-cols-3"},Tt={class:"overflow-hidden bg-white shadow sm:rounded-lg"},Ct={class:"px-4 py-5 sm:p-6"},Dt={class:"mt-2 text-3xl font-bold text-gray-900"},Mt={class:"text-xs text-gray-500"},$t={key:0,class:"mt-4 flex flex-wrap gap-2"},Bt=["disabled"],It=["disabled"],Et={class:"overflow-hidden bg-white shadow sm:rounded-lg"},St={class:"px-4 py-5 sm:p-6"},Ot={key:0,class:"mt-2"},Nt={class:"text-2xl font-bold text-gray-900 mt-1"},Lt={key:1,class:"mt-2 text-sm text-gray-500"},zt={class:"overflow-hidden bg-white shadow sm:rounded-lg"},Pt={class:"px-4 py-5 sm:p-6"},jt={class:"mt-2 text-3xl font-bold text-gray-900"},At={key:0,class:"mb-6 overflow-hidden bg-white shadow sm:rounded-lg"},Ft={class:"px-4 py-5 sm:p-6"},Rt={class:"overflow-x-auto"},Ut={class:"min-w-full divide-y divide-gray-200"},Vt={class:"divide-y divide-gray-200 bg-white"},Ht={class:"whitespace-nowrap px-6 py-4 text-sm text-indigo-600"},Wt=["onClick"],qt={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},Gt={class:"flex items-center space-x-2"},Jt=["onClick","disabled","aria-label"],Kt={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-4 w-4"},Qt={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-4 w-4"},Xt={key:1,class:"mb-6 overflow-hidden bg-white shadow sm:rounded-lg"},Yt={class:"overflow-hidden bg-white shadow sm:rounded-lg"},Zt={class:"px-4 py-5 sm:p-6"},te={key:0,class:"text-center py-8 text-gray-500"},ee={key:1,class:"overflow-x-auto"},se={class:"min-w-full divide-y divide-gray-200"},ae={class:"divide-y divide-gray-200 bg-white"},oe={class:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900"},ne={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},le={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ie={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},re={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ce={class:"flex items-center space-x-2"},de=["disabled"],ue=["disabled"],xe=["disabled"],pe=["disabled"],ye={class:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900"},he={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},me={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ge={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ve={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},_e={class:"flex items-center space-x-2"},ke=["onClick","disabled"],fe=["disabled"],we={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},be={class:"w-full max-w-2xl rounded-lg bg-white shadow-lg"},Te={class:"flex items-center justify-between border-b px-4 py-3"},Ce={class:"p-4"},De={key:0,class:"text-gray-500 text-sm"},Me={key:1,class:"overflow-x-auto"},$e={class:"min-w-full divide-y divide-gray-200"},Be={class:"divide-y divide-gray-200 bg-white"},Ie={class:"px-4 py-2 text-sm text-gray-900"},Ee={class:"px-4 py-2 text-sm text-gray-700"},Se={class:"px-4 py-2 text-sm text-gray-700"},Oe={class:"px-4 py-2 text-sm text-gray-700"},Ne={class:"px-4 py-2 text-sm text-gray-900"},Le={class:"px-4 py-2 text-sm text-gray-700"},ze={class:"px-4 py-2 text-sm text-gray-700"},Pe={class:"px-4 py-2 text-sm text-gray-700"},je={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Ae={class:"w-full max-w-lg rounded-lg bg-white shadow-lg"},Fe={class:"flex items-center justify-between border-b px-4 py-3"},Re={key:0,class:"p-4 text-sm text-gray-700"},Ue={class:"font-medium mb-1"},Ve={class:"mb-2"},He={key:0,class:"mb-2"},We=["href"],qe={key:1,class:"prose max-w-none"},Xe=ht({__name:"Dashboard",setup(Ge){const c=p(null),d=p(!1),w=p(""),b=p(new Date),P=p("employee"),j=p([]);p(null);const x=p(null),E=p(!1),H=p([]),M=p([]),k=p(null),S=p(!1);let A=null;const m=_(()=>{var s,t;return!!((s=c.value)!=null&&s.clock_in)&&!((t=c.value)!=null&&t.clock_out)}),v=_(()=>{var s,t;return!!((s=c.value)!=null&&s.break_start)&&!((t=c.value)!=null&&t.break_end)}),Q=_(()=>{var s,t;return((s=c.value)==null?void 0:s.lunch_start)&&!((t=c.value)!=null&&t.lunch_end)}),f=s=>s?(typeof s=="string"?new Date(s):s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"--",O=(s,t)=>{if(!s||!t)return"--";const o=new Date(s),u=new Date(t).getTime()-o.getTime(),h=Math.floor(u/36e5),z=Math.floor(u%36e5/6e4),a=Math.floor(u%6e4/1e3);return`${h}h ${z}m ${a}s`},F=_(()=>{const s=[];if(!c.value)return s;const t=c.value;return s.push({type:"Clock In",start:t.clock_in||null,end:null,duration:"--",status:t.clock_in?"Completed":"Not started"}),(t.break_start||t.break_end)&&s.push({type:"Break",start:t.break_start||null,end:t.break_end||null,duration:t.break_start&&t.break_end?O(t.break_start,t.break_end):t.break_start?"In progress":"--",status:t.break_start&&t.break_end?"Completed":t.break_start?"Active":"Scheduled"}),(t.lunch_start||t.lunch_end)&&s.push({type:"Lunch",start:t.lunch_start||null,end:t.lunch_end||null,duration:t.lunch_start&&t.lunch_end?O(t.lunch_start,t.lunch_end):t.lunch_start?"In progress":"--",status:t.lunch_start&&t.lunch_end?"Completed":t.lunch_start?"Active":"Scheduled"}),t.clock_out&&s.push({type:"Clock Out",start:t.clock_out||null,end:null,duration:"--",status:t.clock_out?"Completed":"Pending"}),s});mt(()=>{$(),X(),B(),L(),A=window.setInterval(()=>{b.value=new Date},1e3)}),gt(()=>{A&&window.clearInterval(A)});const $=async()=>{try{const s=await y.get("/time-entries/current");c.value=s.data,lt()}catch(s){c.value=null,w.value="No entry today",console.error("Error fetching current entry:",s)}},X=async()=>{var s;try{const o=(((s=(await y.get("/admin/users")).data)==null?void 0:s.data)||[]).find(n=>(n==null?void 0:n.id)&&(n==null?void 0:n.email));o!=null&&o.role&&(P.value=o.role)}catch{}},B=async()=>{try{const s=await y.get("/my/tasks");j.value=s.data}catch{}},R=async()=>{try{await it()}catch{}},U=async()=>{try{await rt()}catch{}},W=async()=>{try{await ct()}catch{}},N=async()=>{try{await dt()}catch{}},L=async()=>{try{const s=await y.get("/tasks/today-entries");M.value=s.data||[]}catch{M.value=[]}},q=async s=>{try{const t=await y.get(`/tasks/${s}/sync`);k.value=t.data,S.value=!0}catch{S.value=!1}},Y=async()=>{if(v.value){await N();return}m.value?await U():await R()},Z=async()=>{if(x.value){alert("Pause or stop the running task first.");return}v.value?await N():(m.value||await R(),await W())},T=s=>s<10?`0${s}`:`${s}`,tt=_(()=>{var s,t;return v.value&&((s=c.value)!=null&&s.break_start)?new Date(c.value.break_start):m.value&&((t=c.value)!=null&&t.clock_in)?new Date(c.value.clock_in):null}),et=_(()=>{const s=M.value.find(t=>t.clock_in&&!t.clock_out);return s?new Date(s.clock_in):null}),st=_(()=>{const s=tt.value;if(!s)return"00:00:00";const t=b.value.getTime()-s.getTime(),o=Math.max(0,Math.floor(t/1e3)),n=Math.floor(o/3600),u=Math.floor(o%3600/60),h=o%60;return`${T(n)}:${T(u)}:${T(h)}`}),at=_(()=>{const s=et.value;if(!s)return"00:00:00";const t=b.value.getTime()-s.getTime(),o=Math.max(0,Math.floor(t/1e3)),n=Math.floor(o/3600),u=Math.floor(o%3600/60),h=o%60;return`${T(n)}:${T(u)}:${T(h)}`}),ot=_(()=>{const s=c.value;if(!s||!s.clock_in)return 0;const t=new Date(s.clock_in),o=s.clock_out?new Date(s.clock_out):b.value;let n=Math.max(0,Math.floor((o.getTime()-t.getTime())/6e4));if(s.break_start&&s.break_end){const u=new Date(s.break_start),h=new Date(s.break_end);n-=Math.max(0,Math.floor((h.getTime()-u.getTime())/6e4))}else if(s.break_start&&!s.break_end){const u=new Date(s.break_start);n-=Math.max(0,Math.floor((b.value.getTime()-u.getTime())/6e4))}if(s.lunch_start&&s.lunch_end){const u=new Date(s.lunch_start),h=new Date(s.lunch_end);n-=Math.max(0,Math.floor((h.getTime()-u.getTime())/6e4))}else if(s.lunch_start&&!s.lunch_end){const u=new Date(s.lunch_start);n-=Math.max(0,Math.floor((b.value.getTime()-u.getTime())/6e4))}return(Math.max(0,n)/60).toFixed(2)}),nt=async()=>{try{E.value=!0,H.value=[c.value].filter(Boolean)}catch{E.value=!0,H.value=[]}},lt=()=>{!c.value||!c.value.clock_in?w.value="Not clocked in":c.value.clock_out?w.value="Clocked out":Q.value?w.value="On lunch":v.value?w.value="On break":w.value="Clocked in"},it=async s=>{var t,o;d.value=!0;try{const n={};await y.post("/time-entries/clock-in",n),await $(),await B()}catch(n){alert(((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||"Error clocking in")}finally{d.value=!1}},rt=async()=>{var s,t;d.value=!0;try{if(x.value){alert("Pause or stop the running task first."),d.value=!1;return}await y.post("/time-entries/clock-out"),await $(),await B()}catch(o){alert(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||"Error clocking out")}finally{d.value=!1}},ct=async()=>{var s,t;d.value=!0;try{await y.post("/time-entries/break-start"),await $(),await B()}catch(o){alert(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||"Error starting break")}finally{d.value=!1}},dt=async()=>{var s,t;d.value=!0;try{await y.post("/time-entries/break-end"),await $(),await B()}catch(o){alert(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||"Error ending break")}finally{d.value=!1}},G=async s=>{var t,o;if(!m.value){alert("Please Time In first before starting a task.");return}if(v.value&&await N(),x.value&&x.value!==s)try{await y.post("/tasks/stop")}catch{}try{await y.post("/tasks/start",{task_id:s}),x.value=s,await L()}catch(n){alert(((o=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to start task")}},ut=async()=>{try{await y.post("/tasks/stop")}catch{}x.value=null,await L()},xt=async()=>{if(m.value){try{await y.post("/tasks/stop")}catch{await U()}x.value=null,await L()}};return(s,t)=>(r(),l(D,null,[J(vt(_t),{title:"Dashboard"}),J(yt,null,{header:K(()=>[...t[4]||(t[4]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Time Tracker Dashboard ",-1)])]),default:K(()=>{var o,n,u,h,z;return[e("div",ft,[e("div",wt,[e("div",bt,[e("div",Tt,[e("div",Ct,[t[5]||(t[5]=e("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"},"Work Day Timer",-1)),e("p",Dt,i(st.value),1),e("p",Mt,i(v.value?"On Break":m.value?"Working":"Idle"),1),P.value!=="admin"?(r(),l("div",$t,[e("button",{onClick:Y,disabled:d.value,class:V(["rounded-md px-3 py-1.5 text-xs font-semibold text-white",m.value?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"])},i(m.value?"Time Out":"Time In"),11,Bt),e("button",{onClick:Z,disabled:d.value,class:V(["rounded-md px-3 py-1.5 text-xs font-semibold text-white",v.value?"bg-orange-600 hover:bg-orange-700":"bg-yellow-600 hover:bg-yellow-700"])},i(v.value?"Break Out":"Break In"),11,It)])):C("",!0)])]),e("div",Et,[e("div",St,[t[6]||(t[6]=e("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"},"Running Task",-1)),x.value?(r(),l("div",Ot,[e("button",{onClick:t[0]||(t[0]=a=>q(x.value)),class:"text-indigo-600 hover:underline text-sm"},i(((o=j.value.find(a=>a.id===x.value))==null?void 0:o.title)||"#"+x.value),1),e("p",Nt,i(at.value),1)])):(r(),l("div",Lt,"No task running"))])]),e("div",zt,[e("div",Pt,[t[9]||(t[9]=e("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"},"Daily Logs",-1)),e("p",jt,[kt(i(ot.value),1),t[7]||(t[7]=e("span",{class:"text-sm font-normal text-gray-500"}," / 8 Hours",-1))]),e("div",{class:"mt-4 flex space-x-2"},[e("button",{onClick:nt,class:"rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-indigo-700"},"Daily Logs"),t[8]||(t[8]=e("button",{class:"rounded-md bg-yellow-500 px-3 py-1.5 text-xs font-semibold text-white hover:bg-yellow-600"},"Send Report",-1))])])])]),P.value!=="admin"?(r(),l("div",At,[e("div",Ft,[t[13]||(t[13]=e("div",{class:"flex items-center justify-between mb-3"},[e("h3",{class:"text-lg font-medium leading-6 text-gray-900"},"My Tasks")],-1)),e("div",Rt,[e("table",Ut,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Task"),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Actions")])],-1)),e("tbody",Vt,[(r(!0),l(D,null,I(j.value,a=>(r(),l("tr",{key:a.id},[e("td",Ht,[e("button",{onClick:g=>q(a.id),class:"hover:underline"},i(a.title),9,Wt)]),e("td",qt,[e("div",Gt,[e("button",{onClick:g=>x.value===a.id?ut():G(a.id),disabled:d.value,class:V(["rounded-full p-2 text-white",x.value===a.id?"bg-yellow-600 hover:bg-yellow-700":"bg-green-600 hover:bg-green-700"]),"aria-label":x.value===a.id?"Pause":"Play"},[x.value!==a.id?(r(),l("svg",Kt,[...t[10]||(t[10]=[e("path",{d:"M8 5v14l11-7z"},null,-1)])])):(r(),l("svg",Qt,[...t[11]||(t[11]=[e("path",{d:"M6 5h4v14H6zM14 5h4v14h-4z"},null,-1)])]))],10,Jt)])])]))),128))])])])])])):(r(),l("div",Xt,[...t[14]||(t[14]=[e("div",{class:"px-4 py-5 sm:p-6 text-sm text-gray-600"}," Admin view: see current time above and the real-time events table below. ",-1)])])),e("div",Yt,[e("div",Zt,[t[16]||(t[16]=e("h3",{class:"text-lg font-medium leading-6 text-gray-900 mb-4"},"Today's Time Events",-1)),F.value.length===0?(r(),l("div",te," No time entries recorded today. Clock in to start tracking time. ")):(r(),l("div",ee,[e("table",se,[t[15]||(t[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Event Type "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Start Time "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," End Time "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Duration "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Status ")])],-1)),e("tbody",ae,[(r(!0),l(D,null,I(F.value,(a,g)=>(r(),l("tr",{key:g},[e("td",oe,i(a.type),1),e("td",ne,i(f(a.start)),1),e("td",le,i(f(a.end)),1),e("td",ie,i(a.duration),1),e("td",re,[e("div",ce,[e("button",{onClick:R,disabled:d.value||m.value,class:"rounded-md bg-green-600 px-2 py-1 text-xs font-semibold text-white hover:bg-green-700"},"Time In",8,de),e("button",{onClick:W,disabled:d.value||!m.value||v.value,class:"rounded-md bg-yellow-600 px-2 py-1 text-xs font-semibold text-white hover:bg-yellow-700"},"Break In",8,ue),e("button",{onClick:N,disabled:d.value||!v.value,class:"rounded-md bg-orange-600 px-2 py-1 text-xs font-semibold text-white hover:bg-orange-700"},"Break Out",8,xe),e("button",{onClick:U,disabled:d.value||!m.value,class:"rounded-md bg-red-600 px-2 py-1 text-xs font-semibold text-white hover:bg-red-700"},"Time Out",8,pe)])])]))),128)),(r(!0),l(D,null,I(M.value,a=>{var g;return r(),l("tr",{key:`task-${a.id}`},[e("td",ye," Task: "+i(((g=a.task)==null?void 0:g.title)||`#${a.task_id}`),1),e("td",he,i(f(a.clock_in)),1),e("td",me,i(f(a.clock_out)),1),e("td",ge,i(a.clock_in&&a.clock_out?O(a.clock_in,a.clock_out):a.clock_in?"In progress":"--"),1),e("td",ve,[e("div",_e,[e("button",{onClick:pt=>G(a.task_id),disabled:d.value,class:"rounded-md bg-green-600 px-2 py-1 text-xs font-semibold text-white hover:bg-green-700"},"Play",8,ke),e("button",{onClick:t[1]||(t[1]=pt=>xt()),disabled:d.value,class:"rounded-md bg-red-600 px-2 py-1 text-xs font-semibold text-white hover:bg-red-700"},"Stop",8,fe)])])])}),128))])])]))])])]),E.value?(r(),l("div",we,[e("div",be,[e("div",Te,[t[17]||(t[17]=e("h4",{class:"text-md font-semibold"},"Daily Logs",-1)),e("button",{onClick:t[2]||(t[2]=a=>E.value=!1),class:"rounded-md bg-gray-100 px-2 py-1 text-xs"},"Close")]),e("div",Ce,[c.value?(r(),l("div",Me,[e("table",$e,[t[18]||(t[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Event"),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Start Time"),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"End Time"),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Duration")])],-1)),e("tbody",Be,[(r(!0),l(D,null,I(F.value,(a,g)=>(r(),l("tr",{key:g},[e("td",Ie,i(a.type),1),e("td",Ee,i(f(a.start)),1),e("td",Se,i(f(a.end)),1),e("td",Oe,i(a.duration),1)]))),128)),(r(!0),l(D,null,I(M.value,a=>{var g;return r(),l("tr",{key:`modal-task-${a.id}`},[e("td",Ne,"Task: "+i(((g=a.task)==null?void 0:g.title)||`#${a.task_id}`),1),e("td",Le,i(f(a.clock_in)),1),e("td",ze,i(f(a.clock_out)),1),e("td",Pe,i(a.clock_in&&a.clock_out?O(a.clock_in,a.clock_out):a.clock_in?"In progress":"--"),1)])}),128))])])])):(r(),l("div",De,"No entry today."))])])])):C("",!0),S.value?(r(),l("div",je,[e("div",Ae,[e("div",Fe,[t[19]||(t[19]=e("h4",{class:"text-md font-semibold"},"Task Details",-1)),e("button",{onClick:t[3]||(t[3]=a=>S.value=!1),class:"rounded-md bg-gray-100 px-2 py-1 text-xs"},"Close")]),k.value?(r(),l("div",Re,[e("p",Ue,i((n=k.value.task)==null?void 0:n.title),1),e("p",Ve,"Status: "+i((u=k.value.task)==null?void 0:u.status),1),(h=k.value.clickup)!=null&&h.url?(r(),l("p",He,[e("a",{href:k.value.clickup.url,target:"_blank",class:"text-indigo-600 hover:underline"},"Open in ClickUp",8,We)])):C("",!0),(z=k.value.clickup)!=null&&z.text_content?(r(),l("div",qe,i(k.value.clickup.text_content),1)):C("",!0)])):C("",!0)])])):C("",!0)])]}),_:1})],64))}});export{Xe as default};
