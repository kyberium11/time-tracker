import{d as Y,D as tt,c as r,o as et,w as at,a as o,b as I,u as _,h as st,e as $,f as t,l as k,g as n,F as u,k as f,t as l,v as it,m as N,n as W,q as B}from"./app-D4sziTso.js";import{_ as nt}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-BSKq9_hP.js";import{a as p}from"./api-ttKFNz3H.js";import{C as ot,a as rt,L as lt,B as dt,P as ct,b as ut,p as gt,c as yt,d as ft,i as pt,e as mt,f as xt}from"./index-Docp_qGx.js";const ht={class:"py-12"},vt={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},bt={class:"bg-white shadow rounded-lg p-6"},_t={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},kt=["value"],wt={class:"bg-white shadow rounded-lg px-4 py-3"},Dt={class:"flex flex-wrap gap-2"},Et=["onClick"],Ct={key:0,class:"space-y-6"},At={key:0,class:"bg-white shadow rounded-lg p-6 text-center text-gray-500"},zt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},Ut={class:"bg-white overflow-hidden shadow rounded-lg"},Tt={class:"p-5"},Ft={class:"text-2xl font-semibold text-gray-900 mt-1"},Lt={class:"bg-white overflow-hidden shadow rounded-lg"},St={class:"p-5"},It={class:"text-2xl font-semibold text-gray-900 mt-1"},$t={class:"bg-white overflow-hidden shadow rounded-lg"},Nt={class:"p-5"},Wt={class:"text-2xl font-semibold text-gray-900 mt-1"},Bt={class:"bg-white overflow-hidden shadow rounded-lg"},Mt={class:"p-5"},Gt={class:"text-2xl font-semibold text-gray-900 mt-1"},Ht={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Vt={class:"bg-white shadow rounded-lg overflow-hidden"},Pt={class:"px-4 py-5 sm:p-6",style:{height:"400px"}},Ot={key:1,class:"flex items-center justify-center h-full text-gray-500"},Rt={class:"bg-white shadow rounded-lg overflow-hidden"},jt={class:"px-4 py-5 sm:p-6",style:{height:"400px"}},Zt={key:1,class:"flex items-center justify-center h-full text-gray-500"},qt={key:1,class:"space-y-6"},Qt={class:"bg-white shadow rounded-lg p-6"},Jt={key:0,class:"text-center text-gray-500 py-12"},Kt={key:0,class:"text-sm text-gray-500"},Xt={key:1,class:"overflow-x-auto"},Yt={class:"min-w-full divide-y divide-gray-200"},te={class:"bg-white divide-y divide-gray-200"},ee={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ae={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},se={class:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-700"},ie={class:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-700"},ne={key:2,class:"space-y-6"},oe={class:"bg-white shadow rounded-lg p-6"},re={key:0,class:"text-center text-gray-500 py-12"},le={key:0,class:"text-sm text-gray-500"},de={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},ce={class:"text-sm font-medium text-indigo-700"},ue={class:"text-2xl font-semibold text-indigo-900 mt-2"},ge={key:3,class:"space-y-6"},ye={class:"bg-white shadow rounded-lg p-6"},fe={key:0,class:"text-center text-gray-500 py-12"},pe={key:0,class:"text-sm text-gray-500"},me={key:1,class:"overflow-x-auto"},xe={class:"min-w-full divide-y divide-gray-200"},he={class:"bg-white divide-y divide-gray-200"},ve={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},be={class:"px-6 py-4 whitespace-nowrap text-center text-sm text-green-600 font-semibold"},_e={class:"px-6 py-4 whitespace-nowrap text-center text-sm text-yellow-600 font-semibold"},ke={class:"px-6 py-4 whitespace-nowrap text-center text-sm text-red-600 font-semibold"},ze=Y({__name:"EfficiencyAnalytics",setup(we){ot.register(rt,lt,dt,ct,ut,gt,yt,ft,pt);const M=[{key:"efficiency",label:"Efficiency"},{key:"work-hour-gaps",label:"Work Hour Gaps"},{key:"utilization",label:"Utilization"},{key:"attendance",label:"Attendance"}],a=tt({activeTab:"efficiency",loading:!1,summary:null,tasks:[],userEfficiency:[],trendData:[],selectedUserId:null,startDate:"",endDate:"",users:[],gaps:{loading:!1,data:[]},utilization:{loading:!1,data:[]},attendance:{loading:!1,data:[]}}),y=r({get:()=>a.activeTab,set:s=>{a.activeTab=s}}),w=r({get:()=>a.selectedUserId,set:s=>{a.selectedUserId=s}}),D=r({get:()=>a.startDate,set:s=>{a.startDate=s}}),E=r({get:()=>a.endDate,set:s=>{a.endDate=s}}),G=r(()=>a.users),H=r(()=>a.loading),d=r(()=>a.summary);r(()=>a.tasks);const x=r(()=>a.userEfficiency),h=r(()=>a.trendData),C=r(()=>a.gaps.data),V=r(()=>a.gaps.loading),A=r(()=>a.utilization.data),P=r(()=>a.utilization.loading),z=r(()=>a.attendance.data),O=r(()=>a.attendance.loading),R=async()=>{var s;try{const e=await p.get("/admin/users",{params:{per_page:1e3}}),i=((s=e.data)==null?void 0:s.data)??e.data;Array.isArray(i)&&(a.users=i)}catch(e){console.error("Error loading users:",e)}},m=()=>{const s={};return a.selectedUserId&&(s.user_id=a.selectedUserId),a.startDate&&(s.start_date=a.startDate),a.endDate&&(s.end_date=a.endDate),s},v=async()=>{var s,e,i;a.loading=!0;try{const g=await p.get("/admin/analytics/efficiency",{params:m()}),c=((s=g.data)==null?void 0:s.data)||g.data;a.summary=(c==null?void 0:c.summary)||null,a.tasks=Array.isArray(c==null?void 0:c.tasks)?c.tasks:[],a.userEfficiency=Array.isArray(c==null?void 0:c.user_efficiency)?c.user_efficiency:[],a.trendData=Array.isArray(c==null?void 0:c.trend)?c.trend:[],console.log("Efficiency data loaded:",{summary:a.summary,tasksCount:a.tasks.length,userEfficiencyCount:a.userEfficiency.length,trendDataCount:a.trendData.length})}catch(g){console.error("Error loading efficiency data:",g),a.summary=null,a.tasks=[],a.userEfficiency=[],a.trendData=[],alert(((i=(e=g==null?void 0:g.response)==null?void 0:e.data)==null?void 0:i.error)||"Failed to load efficiency data")}finally{a.loading=!1}},U=async()=>{var s,e;a.gaps.loading=!0;try{const i=await p.get("/admin/analytics/utilization/gaps",{params:m()});a.gaps.data=i.data.data??i.data??[]}catch(i){console.error("Error loading gap data:",i),alert(((e=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:e.error)||"Failed to load work hour gaps")}finally{a.gaps.loading=!1}},T=async()=>{var s,e;a.utilization.loading=!0;try{const i=await p.get("/admin/analytics/utilization/summary",{params:m()});a.utilization.data=i.data.data??i.data??[]}catch(i){console.error("Error loading utilization data:",i),alert(((e=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:e.error)||"Failed to load utilization metrics")}finally{a.utilization.loading=!1}},F=async()=>{var s,e;a.attendance.loading=!0;try{const i=await p.get("/admin/analytics/attendance/overview",{params:m()});a.attendance.data=i.data.data??i.data??[]}catch(i){console.error("Error loading attendance data:",i),alert(((e=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:e.error)||"Failed to load attendance metrics")}finally{a.attendance.loading=!1}},L=()=>{a.activeTab==="efficiency"?v():a.activeTab==="work-hour-gaps"?U():a.activeTab==="utilization"?T():a.activeTab==="attendance"&&F()},j=()=>{a.selectedUserId=null;const s=new Date,e=new Date(s);e.setDate(s.getDate()-30),a.endDate=s.toISOString().split("T")[0],a.startDate=e.toISOString().split("T")[0],L()};et(()=>{const s=new Date,e=new Date(s);e.setDate(s.getDate()-30),a.endDate=s.toISOString().split("T")[0],a.startDate=e.toISOString().split("T")[0],R(),v()}),at(()=>a.activeTab,s=>{s==="efficiency"?a.summary||v():s==="work-hour-gaps"?a.gaps.data.length===0&&U():s==="utilization"?a.utilization.data.length===0&&T():s==="attendance"&&a.attendance.data.length===0&&F()});const Z=r(()=>!a.userEfficiency||a.userEfficiency.length===0?{labels:[],datasets:[{label:"Efficiency (%)",data:[],backgroundColor:[],borderColor:[],borderWidth:1}]}:{labels:a.userEfficiency.map(s=>s.user||"Unknown"),datasets:[{label:"Efficiency (%)",data:a.userEfficiency.map(s=>s.efficiency||0),backgroundColor:a.userEfficiency.map(s=>{const e=s.efficiency||0;return e>=100?"rgba(34, 197, 94, 0.8)":e>=90?"rgba(234, 179, 8, 0.8)":"rgba(239, 68, 68, 0.8)"}),borderColor:a.userEfficiency.map(s=>{const e=s.efficiency||0;return e>=100?"rgba(34, 197, 94, 1)":e>=90?"rgba(234, 179, 8, 1)":"rgba(239, 68, 68, 1)"}),borderWidth:1}]}),q={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Efficiency by User"},tooltip:{callbacks:{label:s=>{const e=s.parsed.y;return e!=null?`${e.toFixed(2)}%`:"No data"}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Efficiency (%)"}}}},Q=r(()=>!a.trendData||a.trendData.length===0?{labels:[],datasets:[{label:"Average Efficiency (%)",data:[],borderColor:"rgba(59, 130, 246, 1)",backgroundColor:"rgba(59, 130, 246, 0.1)",borderWidth:2,fill:!0,tension:.4}]}:{labels:a.trendData.map(s=>s.week||""),datasets:[{label:"Average Efficiency (%)",data:a.trendData.map(s=>s.efficiency!==null&&s.efficiency!==void 0?s.efficiency:null),borderColor:"rgba(59, 130, 246, 1)",backgroundColor:"rgba(59, 130, 246, 0.1)",borderWidth:2,fill:!0,tension:.4,spanGaps:!0}]}),J={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},title:{display:!0,text:"Average Efficiency Trend (Last 12 Weeks)"},tooltip:{callbacks:{label:s=>{const e=s.parsed.y;return e!==null?`${e.toFixed(2)}%`:"No data"}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Efficiency (%)"}}}},K=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"}),b=s=>`${s.toFixed(2)} hrs`,S=(s,e)=>s-e,X=s=>`${s.toFixed(2)}%`;return(s,e)=>(n(),o(u,null,[I(_(st),{title:"Metrics"}),I(nt,null,{header:$(()=>[...e[3]||(e[3]=[t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Metrics",-1)])]),default:$(()=>[t("div",ht,[t("div",vt,[t("div",bt,[e[8]||(e[8]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Filters",-1)),t("div",_t,[t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"User",-1)),k(t("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>w.value=i),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[e[4]||(e[4]=t("option",{value:null},"All Users",-1)),(n(!0),o(u,null,f(G.value,i=>(n(),o("option",{key:i.id,value:i.id},l(i.name),9,kt))),128))],512),[[it,w.value]])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Start Date",-1)),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>D.value=i),type:"date",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[N,D.value]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"End Date",-1)),k(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>E.value=i),type:"date",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[N,E.value]])]),t("div",{class:"flex items-end gap-2"},[t("button",{onClick:L,class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"}," Apply Filters "),t("button",{onClick:j,class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Clear ")])])]),t("div",wt,[t("nav",Dt,[(n(),o(u,null,f(M,i=>t("button",{key:i.key,onClick:g=>y.value=i.key,class:W(["px-4 py-2 rounded-md text-sm font-medium transition",y.value===i.key?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},l(i.label),11,Et)),64))])]),y.value==="efficiency"?(n(),o("section",Ct,[H.value?(n(),o("div",At,[...e[9]||(e[9]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"},null,-1),t("p",{class:"mt-4"},"Loading efficiency data…",-1)])])):(n(),o(u,{key:1},[t("div",zt,[t("div",Ut,[t("div",Tt,[e[10]||(e[10]=t("dt",{class:"text-sm font-medium text-gray-500"},"Average Efficiency",-1)),t("dd",Ft,l(d.value&&d.value.average_efficiency!==void 0&&d.value.average_efficiency!==null?d.value.average_efficiency.toFixed(2):"0.00")+"% ",1)])]),t("div",Lt,[t("div",St,[e[11]||(e[11]=t("dt",{class:"text-sm font-medium text-gray-500"},"Total Estimated Time",-1)),t("dd",It,l(d.value&&d.value.total_estimated_time!==void 0&&d.value.total_estimated_time!==null?d.value.total_estimated_time.toFixed(2):"0.00")+" hrs ",1)])]),t("div",$t,[t("div",Nt,[e[12]||(e[12]=t("dt",{class:"text-sm font-medium text-gray-500"},"Total Tracked Time",-1)),t("dd",Wt,l(d.value&&d.value.total_tracked_time!==void 0&&d.value.total_tracked_time!==null?d.value.total_tracked_time.toFixed(2):"0.00")+" hrs ",1)])]),t("div",Bt,[t("div",Mt,[e[13]||(e[13]=t("dt",{class:"text-sm font-medium text-gray-500"},"Overrun Rate",-1)),t("dd",Gt,l(d.value&&d.value.overrun_rate!==void 0&&d.value.overrun_rate!==null?d.value.overrun_rate.toFixed(2):"0.00")+"% ",1)])])]),t("div",Ht,[t("div",Vt,[t("div",Pt,[x.value&&x.value.length>0?(n(),B(_(mt),{key:`user-chart-${x.value.length}`,data:Z.value,options:q},null,8,["data"])):(n(),o("div",Ot,"No user efficiency data available"))])]),t("div",Rt,[t("div",jt,[h.value&&h.value.length>0?(n(),B(_(xt),{key:`trend-chart-${h.value.length}`,data:Q.value,options:J},null,8,["data"])):(n(),o("div",Zt,"No trend data available"))])])])],64))])):y.value==="work-hour-gaps"?(n(),o("section",qt,[t("div",Qt,[e[16]||(e[16]=t("h3",{class:"text-lg font-medium text-gray-900"},"Work Hour Gaps",-1)),e[17]||(e[17]=t("p",{class:"text-sm text-gray-500 mb-4"}," Compare total time tracked via clock-ins against task-tracked hours to highlight potential idle time. ",-1)),V.value?(n(),o("div",Jt,[...e[14]||(e[14]=[t("div",{class:"inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"},null,-1),t("p",{class:"mt-3"},"Loading work hour gaps…",-1)])])):(n(),o(u,{key:1},[C.value.length===0?(n(),o("div",Kt,"No gaps recorded for the selected range.")):(n(),o("div",Xt,[t("table",Yt,[e[15]||(e[15]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"User"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Worked Hours"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Task Hours"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Gap")])],-1)),t("tbody",te,[(n(!0),o(u,null,f(C.value,i=>(n(),o("tr",{key:`${i.user}-${i.date}`},[t("td",ee,l(K(i.date)),1),t("td",ae,l(i.user),1),t("td",se,l(b(i.worked_hours)),1),t("td",ie,l(b(i.task_hours)),1),t("td",{class:W(["px-6 py-4 whitespace-nowrap text-right text-sm",S(i.worked_hours,i.task_hours)>=0?"text-green-600":"text-red-600"])},l(b(S(i.worked_hours,i.task_hours))),3)]))),128))])])]))],64))])])):y.value==="utilization"?(n(),o("section",ne,[t("div",oe,[e[19]||(e[19]=t("h3",{class:"text-lg font-medium text-gray-900"},"Utilization",-1)),e[20]||(e[20]=t("p",{class:"text-sm text-gray-500 mb-4"}," Measures the percentage of available hours spent on productive, task-tracked work. ",-1)),P.value?(n(),o("div",re,[...e[18]||(e[18]=[t("div",{class:"inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"},null,-1),t("p",{class:"mt-3"},"Loading utilization metrics…",-1)])])):(n(),o(u,{key:1},[A.value.length===0?(n(),o("div",le,"No utilization data for the selected filters.")):(n(),o("div",de,[(n(!0),o(u,null,f(A.value,i=>(n(),o("div",{key:i.user,class:"rounded-lg border border-indigo-100 bg-indigo-50 p-4"},[t("p",ce,l(i.user),1),t("p",ue,l(X(i.percent)),1)]))),128))]))],64))])])):(n(),o("section",ge,[t("div",ye,[e[23]||(e[23]=t("h3",{class:"text-lg font-medium text-gray-900"},"Attendance Metrics",-1)),e[24]||(e[24]=t("p",{class:"text-sm text-gray-500 mb-4"}," Snapshot of perfect attendance days, late arrivals, and absences within the selected timeframe. ",-1)),O.value?(n(),o("div",fe,[...e[21]||(e[21]=[t("div",{class:"inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"},null,-1),t("p",{class:"mt-3"},"Loading attendance metrics…",-1)])])):(n(),o(u,{key:1},[z.value.length===0?(n(),o("div",pe,"No attendance metrics available.")):(n(),o("div",me,[t("table",xe,[e[22]||(e[22]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"User"),t("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Perfect Days"),t("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Late Days"),t("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Absences")])],-1)),t("tbody",he,[(n(!0),o(u,null,f(z.value,i=>(n(),o("tr",{key:i.user},[t("td",ve,l(i.user),1),t("td",be,l(i.perfect_days),1),t("td",_e,l(i.late_days),1),t("td",ke,l(i.absence_days),1)]))),128))])])]))],64))])]))])])]),_:1})],64))}});export{ze as default};
