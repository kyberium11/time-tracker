import{d as dt,u as ut,c as u,r as m,o as ct,s as mt,f as W,b as vt,g as s,e as pt,h as ft,a as l,k as bt,j as r,t as v,i as Y,m as j,F as f,l as b,v as gt,p as q,C as h}from"./app-D5AyA0x7.js";import{_ as ht}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-BsulLUh4.js";import{a as J}from"./api-S42fFdQu.js";const xt={class:"py-6"},yt={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},_t={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},wt={class:"border-b border-gray-200 px-6 py-4"},kt={class:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between"},Dt={class:"mt-1 text-sm text-gray-500"},St={key:0},$t={key:1},Tt={class:"font-mono"},Mt={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-4"},Lt={class:"flex flex-wrap items-end gap-4"},zt={key:0,class:"min-w-[200px]"},Ut=["value"],It={class:"flex gap-2"},jt=["disabled"],Ct=["disabled"],Ft={class:"flex items-center gap-2"},At=["disabled"],Bt={class:"px-2 text-xs font-semibold text-gray-700 border border-gray-200 rounded-md bg-white"},Vt=["disabled"],Et={class:"px-6 py-4"},Ht={key:0,class:"mb-4 rounded-md bg-red-50 p-4 text-sm text-red-700"},Nt={key:1,class:"flex items-center justify-center py-16"},Pt={key:2,class:"space-y-6"},Rt={key:0,class:"py-10 text-center text-sm text-gray-500"},Gt={key:1},Ot={class:"overflow-x-auto"},Zt={class:"min-w-full"},Wt={class:"mb-3 flex items-center text-xs text-gray-500"},Yt={class:"flex-1"},qt={class:"space-y-4"},Jt={class:"w-36 text-sm font-medium text-gray-700"},Kt={class:"flex-1"},Qt=["title"],Xt=["title"],te={class:"truncate"},ee=["title"],se={class:"truncate"},D=24,oe=2,ie=dt({__name:"TimeGraph",setup(ae){const K=ut(),Q=u(()=>{var t;const e=K.props.auth;return((t=e==null?void 0:e.user)==null?void 0:t.role)??null}),X=u(()=>["admin","developer","manager"].includes(Q.value??"")),x=m(!0),g=m(null),C=m([]),F=m("Asia/Manila"),y=m({start:"",end:""}),d=m({userId:null,startDate:"",endDate:""}),S=m([]),k=m(!1),A=e=>e.toISOString().slice(0,10),B=()=>{const e=new Date,t=new Date;t.setDate(t.getDate()-4),d.value.startDate=A(t),d.value.endDate=A(e)},tt=async()=>{if(X.value)try{const e=await J.get("/admin/users",{params:{per_page:1e3}}),t=e.data&&e.data.data||e.data;Array.isArray(t)?(S.value=t,k.value=S.value.length>0):k.value=!1}catch(e){console.error("Failed to load users for Time Graph filter",e),k.value=!1}},$=async()=>{var e,t;x.value=!0,g.value=null;try{const o={};d.value.userId&&(o.user_id=String(d.value.userId)),d.value.startDate&&(o.start_date=d.value.startDate),d.value.endDate&&(o.end_date=d.value.endDate);const{data:n}=await J.get("/my/time-graph",{params:o});C.value=n.days||[],F.value=n.timezone||"Asia/Manila",y.value={start:n.start_date,end:n.end_date}}catch(o){console.error(o),g.value=((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.error)||"Unable to load time graph data. Please try again."}finally{x.value=!1}},et=()=>{if(d.value.startDate&&d.value.endDate){const e=new Date(d.value.startDate),t=new Date(d.value.endDate);if(t<e){g.value="End date must be on or after the start date.";return}if((t.getTime()-e.getTime())/(1e3*60*60*24)>30){g.value="Please limit the range to 31 days or less.";return}}$()},st=()=>{B(),$()};ct(()=>{B(),tt(),$()});const V=e=>{let t=e;for(;t<0;)t+=24;for(;t>=24;)t-=24;return t},T=(e,t)=>{if(t-e>=24)return[{start:0,end:24}];const n=V(e);let a=V(t);return t-e<=0?[{start:n,end:24},{start:0,end:a}]:(a<=n&&t>e&&(a+=24),a>24?[{start:n,end:24},{start:0,end:a-24}]:[{start:n,end:a}])},E=[4,2,1,.5],_=m(1),H=u(()=>_.value>0),N=u(()=>_.value<E.length-1),ot=()=>{H.value&&(_.value-=1)},at=()=>{N.value&&(_.value+=1)},M=u(()=>E[_.value]),nt=u(()=>{const e=M.value;return e>=1?`${e} hr`:`${Math.round(e*60)} min`}),rt=u(()=>oe/M.value),P=u(()=>`${Math.max(rt.value,1)*100}%`),p=e=>{const t=(e%24+24)%24,o=Math.floor(t),n=Math.round(t%1*60),a=o>=12?"PM":"AM",c=(o+11)%12+1,i=n===0?"00":n.toString().padStart(2,"0");return`${c}:${i} ${a}`},R=u(()=>{const e=[],t=M.value;for(let o=0;o<=D;o+=t)e.push({label:p(o),value:o});return e}),L=e=>{const t=Math.round(e*3600),o=Math.floor(t/3600),n=Math.floor(t%3600/60),a=t%60,c=i=>i<10?`0${i}`:`${i}`;return`${c(o)}:${c(n)}:${c(a)}`},G=u(()=>C.value.map(e=>{const t=e.shift?T(e.shift.start_hour,e.shift.end_hour).map(a=>{const c=a.end-a.start,i=p(a.start),w=p(a.end);return{...a,tooltip:`Shift · ${i} - ${w} (Total Time: ${L(c)})`}}):[],o=(e.work_hours??[]).flatMap(a=>T(a.start_hour,a.end_hour).map(i=>{const w=i.end-i.start,U=p(i.start),I=p(i.end),Z=a.title||"Work Hours";return{...i,title:Z,tooltip:`${Z} · ${U} - ${I} (Total Time: ${L(w)})`}})),n=e.tasks.flatMap(a=>T(a.start_hour,a.end_hour).map(i=>{const w=i.end-i.start,U=p(i.start),I=p(i.end);return{...i,title:a.title,tooltip:`${a.title||"Task"} · ${U} - ${I} (Total Time: ${L(w)})`}}));return{...e,shiftSegments:t,workSegments:o,taskSegments:n}})),z=e=>{const t=(e.end-e.start)/D*100;return{left:`${e.start/D*100}%`,width:`${Math.max(t,0)}%`}},O=u(()=>{if(!y.value.start||!y.value.end)return"";const e=new Date(y.value.start),t=new Date(y.value.end),o={month:"long",day:"numeric",year:"numeric"};return`${e.toLocaleDateString(void 0,o)} → ${t.toLocaleDateString(void 0,o)}`}),lt=u(()=>G.value.some(e=>e.shiftSegments.length>0||e.workSegments.length>0||e.taskSegments.length>0)),it=u(()=>R.value.map(e=>({...e,style:{left:`${e.value/D*100}%`}})));return(e,t)=>(r(),mt(ht,null,{header:W(()=>[...t[3]||(t[3]=[s("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Time Graph ",-1)])]),default:W(()=>[vt(pt(ft),{title:"Time Graph"}),s("div",xt,[s("div",yt,[s("div",_t,[s("div",wt,[s("div",kt,[s("div",null,[t[5]||(t[5]=s("h3",{class:"text-lg font-medium text-gray-900"}," Shift and Task Schedule ",-1)),s("p",Dt,[O.value?(r(),l("span",St,v(O.value),1)):(r(),l("span",$t,"Last 5 days")),t[4]||(t[4]=bt(" · Timezone: ",-1)),s("span",Tt,v(F.value),1)])]),s("div",Mt,[s("div",Lt,[k.value?(r(),l("div",zt,[t[7]||(t[7]=s("label",{class:"mb-1 block text-sm font-medium text-gray-700"}," User ",-1)),j(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>d.value.userId=o),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[t[6]||(t[6]=s("option",{value:null},"All Users",-1)),(r(!0),l(f,null,b(S.value,o=>(r(),l("option",{key:o.id,value:o.id},v(o.name),9,Ut))),128))],512),[[gt,d.value.userId]])])):Y("",!0),s("div",null,[t[8]||(t[8]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Start Date ",-1)),j(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>d.value.startDate=o),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[q,d.value.startDate]])]),s("div",null,[t[9]||(t[9]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," End Date ",-1)),j(s("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=o=>d.value.endDate=o),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[q,d.value.endDate]])]),s("div",It,[s("button",{type:"button",class:"inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",onClick:et,disabled:x.value}," Apply ",8,jt),s("button",{type:"button",class:"inline-flex items-center rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:st,disabled:x.value}," Reset ",8,Ct)])]),s("div",Ft,[t[12]||(t[12]=s("span",{class:"text-xs font-medium text-gray-500"},"Time Unit",-1)),s("button",{type:"button",class:"inline-flex h-8 w-8 items-center justify-center rounded-md border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 disabled:opacity-40",onClick:ot,disabled:!H.value,"aria-label":"Zoom out"},[...t[10]||(t[10]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 12h14"})],-1)])],8,At),s("span",Bt,v(nt.value),1),s("button",{type:"button",class:"inline-flex h-8 w-8 items-center justify-center rounded-md border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 disabled:opacity-40",onClick:at,disabled:!N.value,"aria-label":"Zoom in"},[...t[11]||(t[11]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 5v14m-7-7h14"})],-1)])],8,Vt)])])])]),s("div",Et,[g.value?(r(),l("div",Ht,v(g.value),1)):Y("",!0),x.value?(r(),l("div",Nt,[...t[13]||(t[13]=[s("div",{class:"inline-block h-10 w-10 animate-spin rounded-full border-b-2 border-indigo-600"},null,-1)])])):(r(),l("div",Pt,[lt.value?(r(),l("div",Gt,[s("div",Ot,[s("div",Zt,[s("div",Wt,[t[14]||(t[14]=s("div",{class:"w-36"},null,-1)),s("div",Yt,[s("div",{class:"flex justify-between text-[11px] font-medium min-w-full",style:h({width:P.value})},[(r(!0),l(f,null,b(R.value,o=>(r(),l("span",{key:o.value},v(o.label),1))),128))],4)])]),s("div",qt,[(r(!0),l(f,null,b(G.value,o=>(r(),l("div",{key:o.date,class:"flex items-center gap-4"},[s("div",Jt,v(o.label),1),s("div",Kt,[s("div",{class:"relative h-16 rounded-md border border-gray-200 bg-gray-50 min-w-full",style:h({width:P.value})},[(r(!0),l(f,null,b(it.value,n=>(r(),l("div",{key:n.value,class:"absolute inset-y-0 border-l border-gray-200 last:border-r-0",style:h(n.style)},null,4))),128)),(r(!0),l(f,null,b(o.shiftSegments,(n,a)=>(r(),l("div",{key:`shift-${o.date}-${a}`,class:"absolute bottom-1 h-3 rounded-md bg-sky-200/70 border border-sky-400",style:h(z(n)),title:n.tooltip},null,12,Qt))),128)),(r(!0),l(f,null,b(o.workSegments,(n,a)=>(r(),l("div",{key:`work-${o.date}-${a}`,class:"absolute top-6 h-4 rounded-md bg-amber-300 border border-amber-500 text-[10px] font-semibold text-amber-900 flex items-center justify-center px-2 shadow",style:h(z(n)),title:n.tooltip},[s("span",te,v(n.title),1)],12,Xt))),128)),(r(!0),l(f,null,b(o.taskSegments,(n,a)=>(r(),l("div",{key:`task-${o.date}-${a}`,class:"absolute top-1 h-4 rounded-md bg-emerald-400 border border-emerald-600 text-[11px] font-medium text-emerald-900 flex items-center justify-center px-2 shadow",style:h(z(n)),title:n.tooltip},[s("span",se,v(n.title),1)],12,ee))),128))],4)])]))),128))])])])])):(r(),l("div",Rt," No shift or task data for this period. ")),t[15]||(t[15]=s("div",{class:"flex items-center gap-4 text-sm text-gray-600"},[s("div",{class:"flex items-center gap-2"},[s("span",{class:"inline-block h-3 w-6 rounded-sm bg-sky-400 border border-sky-600"}),s("span",null,"Shift")]),s("div",{class:"flex items-center gap-2"},[s("span",{class:"inline-block h-3 w-6 rounded-sm bg-amber-300 border border-amber-600"}),s("span",null,"Work Hours")]),s("div",{class:"flex items-center gap-2"},[s("span",{class:"inline-block h-3 w-6 rounded-sm bg-emerald-500 border border-emerald-700"}),s("span",null,"Task")])],-1))]))])])])])]),_:1}))}});export{ie as default};
