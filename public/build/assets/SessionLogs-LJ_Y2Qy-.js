import{d as T,r as g,o as D,w as N,a as n,b,e as U,h as V,f as h,g as e,i as F,m,j as i,F as x,l as w,t as d,v as M,p as k,O as j}from"./app-B6d0F_wu.js";import{_ as $}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-C_KJIoWK.js";const B={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},O={class:"flex items-center gap-2"},P=["disabled"],A=["disabled"],E={class:"mx-auto max-w-7xl py-6 sm:px-6 lg:px-8"},R={class:"rounded-lg bg-white p-4 shadow"},J={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4"},q={class:"space-y-1"},z=["value"],G={class:"space-y-1"},H={class:"space-y-1"},I={class:"mt-6 overflow-x-auto"},K={class:"min-w-full divide-y divide-gray-200 text-sm"},Q={class:"divide-y divide-gray-200"},W={key:0},X={key:1},Y={class:"px-4 py-3 text-gray-900 whitespace-nowrap"},Z={class:"px-4 py-3 text-gray-900"},ee={class:"font-medium"},te={class:"text-xs text-gray-500"},se={class:"px-4 py-3 text-gray-900"},oe={class:"rounded bg-indigo-50 px-2 py-1 text-xs font-semibold text-indigo-700"},ae={class:"px-4 py-3 text-gray-700 max-w-xs"},de={class:"line-clamp-3 whitespace-pre-wrap"},le={class:"px-4 py-3 text-gray-700 max-w-sm"},re={class:"line-clamp-3 break-words"},ne={key:0,class:"mt-4 flex items-center justify-between text-sm text-gray-600"},ie={class:"flex items-center gap-2"},ue=["disabled"],ce=["disabled"],xe=T({__name:"SessionLogs",setup(ge){const p=g([]),f=g([]),r=g(!1),o=g(null),l=g({user_id:"",start_date:"",end_date:""}),u=async(a=1)=>{var t;r.value=!0;try{const{data:s}=await j.get("/api/admin/session-logs",{params:{...l.value,page:a}});p.value=s.data??[],f.value=((t=s.filters)==null?void 0:t.users)??[],o.value=s.meta??null}catch(s){console.error("Failed to load session logs",s)}finally{r.value=!1}},C=()=>{l.value={user_id:"",start_date:"",end_date:""},u()},y=a=>{o.value&&(a<1||a>o.value.last_page||u(a))},S=a=>a?new Date(a).toLocaleString():"-",L=a=>{if(!a||Object.keys(a).length===0)return"-";try{return JSON.stringify(a)}catch{return"-"}};D(()=>{u()});let v;return N(()=>({...l.value}),()=>{window.clearTimeout(v),v=window.setTimeout(()=>u(),300)},{deep:!0}),(a,t)=>(i(),n(x,null,[b(U(V),{title:"Session Logs"}),b($,null,{header:h(()=>[e("div",B,[t[6]||(t[6]=e("div",null,[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Session Logs "),e("p",{class:"text-sm text-gray-500"}," Developer-only view of captured user clicks and events. ")],-1)),e("div",O,[e("button",{type:"button",class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:t[0]||(t[0]=s=>{var c;return u(((c=o.value)==null?void 0:c.current_page)??1)}),disabled:r.value},d(r.value?"Refreshing...":"Refresh"),9,P),e("button",{type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:C,disabled:r.value}," Clear Filters ",8,A)])])]),default:h(()=>[e("div",E,[e("div",R,[e("div",J,[e("div",q,[t[8]||(t[8]=e("label",{class:"text-sm font-medium text-gray-700"},"User",-1)),m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.user_id=s),class:"block w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[t[7]||(t[7]=e("option",{value:""},"All users",-1)),(i(!0),n(x,null,w(f.value,s=>(i(),n("option",{key:s.id,value:s.id},d(s.name)+" ("+d(s.role)+") ",9,z))),128))],512),[[M,l.value.user_id]])]),e("div",G,[t[9]||(t[9]=e("label",{class:"text-sm font-medium text-gray-700"},"Start date",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>l.value.start_date=s),class:"block w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[k,l.value.start_date]])]),e("div",H,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-gray-700"},"End date",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=s=>l.value.end_date=s),class:"block w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[k,l.value.end_date]])])]),e("div",I,[e("table",K,[t[13]||(t[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-medium text-gray-500"},"Timestamp"),e("th",{class:"px-4 py-3 text-left font-medium text-gray-500"},"User"),e("th",{class:"px-4 py-3 text-left font-medium text-gray-500"},"Action"),e("th",{class:"px-4 py-3 text-left font-medium text-gray-500"},"Description"),e("th",{class:"px-4 py-3 text-left font-medium text-gray-500"},"Metadata")])],-1)),e("tbody",Q,[r.value?(i(),n("tr",W,[...t[11]||(t[11]=[e("td",{colspan:"5",class:"px-4 py-6 text-center text-gray-500"}," Loading logs... ",-1)])])):p.value.length===0?(i(),n("tr",X,[...t[12]||(t[12]=[e("td",{colspan:"5",class:"px-4 py-6 text-center text-gray-500"}," No logs found for the selected filters. ",-1)])])):(i(!0),n(x,{key:2},w(p.value,s=>{var c,_;return i(),n("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",Y,d(S(s.created_at)),1),e("td",Z,[e("div",ee,d(((c=s.user)==null?void 0:c.name)??"Unknown"),1),e("div",te,d(((_=s.user)==null?void 0:_.role)??"n/a"),1)]),e("td",se,[e("span",oe,d(s.action),1)]),e("td",ae,[e("p",de,d(s.description||"-"),1)]),e("td",le,[e("p",re,d(L(s.metadata)),1)])])}),128))])])]),o.value?(i(),n("div",ne,[e("div",null," Page "+d(o.value.current_page)+" of "+d(o.value.last_page)+" ("+d(o.value.total)+" records) ",1),e("div",ie,[e("button",{class:"rounded border border-gray-300 px-3 py-1 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",disabled:o.value.current_page<=1||r.value,onClick:t[4]||(t[4]=s=>y(o.value.current_page-1))}," Previous ",8,ue),e("button",{class:"rounded border border-gray-300 px-3 py-1 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",disabled:o.value.current_page>=o.value.last_page||r.value,onClick:t[5]||(t[5]=s=>y(o.value.current_page+1))}," Next ",8,ce)])])):F("",!0)])])]),_:1})],64))}});export{xe as default};
