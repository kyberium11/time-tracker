import{d as et,r as p,o as st,c as u,q as ot,e as R,b as at,f as e,u as nt,h as rt,a as i,j as lt,g as r,t as m,l as Z,m as G,i as it,C as b,F as h,k as g}from"./app-BPxN3JIx.js";import{_ as dt}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang--U6Pz5Ff.js";import{a as ut}from"./api-DpHxDDa1.js";const ct={class:"py-6"},mt={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},ft={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},pt={class:"border-b border-gray-200 px-6 py-4"},vt={class:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between"},bt={class:"mt-1 text-sm text-gray-500"},ht={key:0},gt={key:1},xt={class:"font-mono"},yt={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-4"},_t={class:"flex flex-wrap items-end gap-4"},wt={class:"flex gap-2"},kt=["disabled"],Dt=["disabled"],$t={class:"flex items-center gap-2"},St=["disabled"],Tt={class:"px-2 text-xs font-semibold text-gray-700 border border-gray-200 rounded-md bg-white"},Mt=["disabled"],Lt={class:"px-6 py-4"},zt={key:0,class:"mb-4 rounded-md bg-red-50 p-4 text-sm text-red-700"},jt={key:1,class:"flex items-center justify-center py-16"},Ct={key:2,class:"space-y-6"},Bt={key:0,class:"py-10 text-center text-sm text-gray-500"},Ft={key:1},At={class:"overflow-x-auto"},Et={class:"min-w-full"},Ht={class:"mb-3 flex items-center text-xs text-gray-500"},It={class:"flex-1"},Nt={class:"space-y-4"},Vt={class:"w-36 text-sm font-medium text-gray-700"},Ut={class:"flex-1"},Ot=["title"],Pt=["title"],Rt={class:"truncate"},Zt=["title"],Gt={class:"truncate"},k=24,Wt=2,Qt=et({__name:"TimeGraph",setup(qt){const x=p(!0),v=p(null),j=p([]),C=p("Asia/Manila"),y=p({start:"",end:""}),d=p({startDate:"",endDate:""}),B=s=>s.toISOString().slice(0,10),F=()=>{const s=new Date,t=new Date;t.setDate(t.getDate()-4),d.value.startDate=B(t),d.value.endDate=B(s)},D=async()=>{var s,t;x.value=!0,v.value=null;try{const o={};d.value.startDate&&(o.start_date=d.value.startDate),d.value.endDate&&(o.end_date=d.value.endDate);const{data:n}=await ut.get("/my/time-graph",{params:o});j.value=n.days||[],C.value=n.timezone||"Asia/Manila",y.value={start:n.start_date,end:n.end_date}}catch(o){console.error(o),v.value=((t=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:t.error)||"Unable to load time graph data. Please try again."}finally{x.value=!1}},W=()=>{if(d.value.startDate&&d.value.endDate){const s=new Date(d.value.startDate),t=new Date(d.value.endDate);if(t<s){v.value="End date must be on or after the start date.";return}if((t.getTime()-s.getTime())/(1e3*60*60*24)>30){v.value="Please limit the range to 31 days or less.";return}}D()},q=()=>{F(),D()};st(()=>{F(),D()});const A=s=>{let t=s;for(;t<0;)t+=24;for(;t>=24;)t-=24;return t},$=(s,t)=>{if(t-s>=24)return[{start:0,end:24}];const n=A(s);let a=A(t);return t-s<=0?[{start:n,end:24},{start:0,end:a}]:(a<=n&&t>s&&(a+=24),a>24?[{start:n,end:24},{start:0,end:a-24}]:[{start:n,end:a}])},E=[4,2,1,.5],_=p(1),H=u(()=>_.value>0),I=u(()=>_.value<E.length-1),Y=()=>{H.value&&(_.value-=1)},J=()=>{I.value&&(_.value+=1)},S=u(()=>E[_.value]),K=u(()=>{const s=S.value;return s>=1?`${s} hr`:`${Math.round(s*60)} min`}),Q=u(()=>Wt/S.value),N=u(()=>`${Math.max(Q.value,1)*100}%`),f=s=>{const t=(s%24+24)%24,o=Math.floor(t),n=Math.round(t%1*60),a=o>=12?"PM":"AM",c=(o+11)%12+1,l=n===0?"00":n.toString().padStart(2,"0");return`${c}:${l} ${a}`},V=u(()=>{const s=[],t=S.value;for(let o=0;o<=k;o+=t)s.push({label:f(o),value:o});return s}),T=s=>{const t=Math.round(s*3600),o=Math.floor(t/3600),n=Math.floor(t%3600/60),a=t%60,c=l=>l<10?`0${l}`:`${l}`;return`${c(o)}:${c(n)}:${c(a)}`},U=u(()=>j.value.map(s=>{const t=s.shift?$(s.shift.start_hour,s.shift.end_hour).map(a=>{const c=a.end-a.start,l=f(a.start),w=f(a.end);return{...a,tooltip:`Shift · ${l} - ${w} (Total Time: ${T(c)})`}}):[],o=(s.work_hours??[]).flatMap(a=>$(a.start_hour,a.end_hour).map(l=>{const w=l.end-l.start,L=f(l.start),z=f(l.end),P=a.title||"Work Hours";return{...l,title:P,tooltip:`${P} · ${L} - ${z} (Total Time: ${T(w)})`}})),n=s.tasks.flatMap(a=>$(a.start_hour,a.end_hour).map(l=>{const w=l.end-l.start,L=f(l.start),z=f(l.end);return{...l,title:a.title,tooltip:`${a.title||"Task"} · ${L} - ${z} (Total Time: ${T(w)})`}}));return{...s,shiftSegments:t,workSegments:o,taskSegments:n}})),M=s=>{const t=(s.end-s.start)/k*100;return{left:`${s.start/k*100}%`,width:`${Math.max(t,0)}%`}},O=u(()=>{if(!y.value.start||!y.value.end)return"";const s=new Date(y.value.start),t=new Date(y.value.end),o={month:"long",day:"numeric",year:"numeric"};return`${s.toLocaleDateString(void 0,o)} → ${t.toLocaleDateString(void 0,o)}`}),X=u(()=>U.value.some(s=>s.shiftSegments.length>0||s.workSegments.length>0||s.taskSegments.length>0)),tt=u(()=>V.value.map(s=>({...s,style:{left:`${s.value/k*100}%`}})));return(s,t)=>(r(),ot(dt,null,{header:R(()=>[...t[2]||(t[2]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Time Graph ",-1)])]),default:R(()=>[at(nt(rt),{title:"Time Graph"}),e("div",ct,[e("div",mt,[e("div",ft,[e("div",pt,[e("div",vt,[e("div",null,[t[4]||(t[4]=e("h3",{class:"text-lg font-medium text-gray-900"}," Shift and Task Schedule ",-1)),e("p",bt,[O.value?(r(),i("span",ht,m(O.value),1)):(r(),i("span",gt,"Last 5 days")),t[3]||(t[3]=lt(" · Timezone: ",-1)),e("span",xt,m(C.value),1)])]),e("div",yt,[e("div",_t,[e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Start Date ",-1)),Z(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>d.value.startDate=o),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[G,d.value.startDate]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," End Date ",-1)),Z(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>d.value.endDate=o),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[G,d.value.endDate]])]),e("div",wt,[e("button",{type:"button",class:"inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",onClick:W,disabled:x.value}," Apply ",8,kt),e("button",{type:"button",class:"inline-flex items-center rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:q,disabled:x.value}," Reset ",8,Dt)])]),e("div",$t,[t[9]||(t[9]=e("span",{class:"text-xs font-medium text-gray-500"},"Time Unit",-1)),e("button",{type:"button",class:"inline-flex h-8 w-8 items-center justify-center rounded-md border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 disabled:opacity-40",onClick:Y,disabled:!H.value,"aria-label":"Zoom out"},[...t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 12h14"})],-1)])],8,St),e("span",Tt,m(K.value),1),e("button",{type:"button",class:"inline-flex h-8 w-8 items-center justify-center rounded-md border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 disabled:opacity-40",onClick:J,disabled:!I.value,"aria-label":"Zoom in"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 5v14m-7-7h14"})],-1)])],8,Mt)])])])]),e("div",Lt,[v.value?(r(),i("div",zt,m(v.value),1)):it("",!0),x.value?(r(),i("div",jt,[...t[10]||(t[10]=[e("div",{class:"inline-block h-10 w-10 animate-spin rounded-full border-b-2 border-indigo-600"},null,-1)])])):(r(),i("div",Ct,[X.value?(r(),i("div",Ft,[e("div",At,[e("div",Et,[e("div",Ht,[t[11]||(t[11]=e("div",{class:"w-36"},null,-1)),e("div",It,[e("div",{class:"flex justify-between text-[11px] font-medium min-w-full",style:b({width:N.value})},[(r(!0),i(h,null,g(V.value,o=>(r(),i("span",{key:o.value},m(o.label),1))),128))],4)])]),e("div",Nt,[(r(!0),i(h,null,g(U.value,o=>(r(),i("div",{key:o.date,class:"flex items-center gap-4"},[e("div",Vt,m(o.label),1),e("div",Ut,[e("div",{class:"relative h-16 rounded-md border border-gray-200 bg-gray-50 min-w-full",style:b({width:N.value})},[(r(!0),i(h,null,g(tt.value,n=>(r(),i("div",{key:n.value,class:"absolute inset-y-0 border-l border-gray-200 last:border-r-0",style:b(n.style)},null,4))),128)),(r(!0),i(h,null,g(o.shiftSegments,(n,a)=>(r(),i("div",{key:`shift-${o.date}-${a}`,class:"absolute bottom-1 h-3 rounded-md bg-sky-200/70 border border-sky-400",style:b(M(n)),title:n.tooltip},null,12,Ot))),128)),(r(!0),i(h,null,g(o.workSegments,(n,a)=>(r(),i("div",{key:`work-${o.date}-${a}`,class:"absolute top-6 h-4 rounded-md bg-amber-300 border border-amber-500 text-[10px] font-semibold text-amber-900 flex items-center justify-center px-2 shadow",style:b(M(n)),title:n.tooltip},[e("span",Rt,m(n.title),1)],12,Pt))),128)),(r(!0),i(h,null,g(o.taskSegments,(n,a)=>(r(),i("div",{key:`task-${o.date}-${a}`,class:"absolute top-1 h-4 rounded-md bg-emerald-400 border border-emerald-600 text-[11px] font-medium text-emerald-900 flex items-center justify-center px-2 shadow",style:b(M(n)),title:n.tooltip},[e("span",Gt,m(n.title),1)],12,Zt))),128))],4)])]))),128))])])])])):(r(),i("div",Bt," No shift or task data for this period. ")),t[12]||(t[12]=e("div",{class:"flex items-center gap-4 text-sm text-gray-600"},[e("div",{class:"flex items-center gap-2"},[e("span",{class:"inline-block h-3 w-6 rounded-sm bg-sky-400 border border-sky-600"}),e("span",null,"Shift")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"inline-block h-3 w-6 rounded-sm bg-amber-300 border border-amber-600"}),e("span",null,"Work Hours")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"inline-block h-3 w-6 rounded-sm bg-emerald-500 border border-emerald-700"}),e("span",null,"Task")])],-1))]))])])])])]),_:1}))}});export{Qt as default};
