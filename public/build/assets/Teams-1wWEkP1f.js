import{d as L,r as c,o as q,c as o,a as N,u as O,h as G,w as D,b as e,e as x,f as l,F as f,i as _,t as i,p as H,g as T,j as S,v as J,n as K}from"./app-CR5BoScY.js";import{_ as P}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-CUcec24M.js";import{a as u}from"./api-BN1pwsbH.js";const Q={class:"flex items-center justify-between"},R={class:"py-12"},W={class:"mx-auto max-w-7xl sm:px-6 lg:px-8 space-y-6"},X={key:0,class:"flex justify-center py-12"},Y={key:1,class:"grid gap-6"},Z={class:"px-6 py-4 border-b border-gray-200"},ee={class:"flex items-center justify-between"},te={class:"text-lg font-medium text-gray-900"},se={key:0,class:"text-sm text-gray-500 mt-1"},ae={class:"flex gap-2"},oe=["onClick"],le=["onClick"],ne=["onClick"],ie={class:"px-6 py-4 space-y-3"},de={key:0,class:"flex items-center text-sm"},re={class:"ml-2 text-gray-900"},ce={key:1,class:"text-sm text-gray-500 italic"},me={class:"mt-4"},ue={class:"text-sm font-medium text-gray-700 mb-2"},ge={key:0,class:"space-y-2"},ve={class:"font-medium text-gray-900"},pe={class:"text-gray-500 ml-2"},be={key:0,class:"text-xs text-gray-600"},xe={key:1,class:"text-sm text-gray-500 italic"},fe={key:0,class:"text-center py-12 text-gray-500"},ye={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},he={class:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0"},_e={class:"relative inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg"},we={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ke={class:"text-lg font-medium leading-6 text-gray-900 mb-4"},Me={class:"mb-4"},Ce={class:"mb-4"},Te={class:"mb-4"},je=["value"],Ee={key:1,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},$e={class:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Ne={class:"relative inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl"},De={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Se={class:"text-lg font-medium leading-6 text-gray-900 mb-4"},Ve={class:"max-h-96 overflow-y-auto"},Ae={class:"space-y-2"},ze=["onClick"],Be={class:"font-medium text-gray-900"},Fe={class:"text-sm text-gray-500"},Ue={key:0,class:"text-xs text-orange-600 mt-1"},Ie={class:"flex items-center"},Le={key:0,class:"w-5 h-5 bg-indigo-600 rounded-full flex items-center justify-center"},qe={key:1,class:"w-5 h-5 border-2 border-gray-300 rounded-full"},Ke=L({__name:"Teams",setup(Oe){const y=c([]),j=c([]),E=c([]),g=c(!1),w=c(!1),k=c(!1),b=c(null),v=c(null),r=c({name:"",description:"",manager_id:null}),m=c({selectedMembers:[]});q(()=>{h(),V()});const h=async()=>{g.value=!0;try{const a=await u.get("/admin/teams");y.value=a.data}catch(a){console.error("Error fetching teams:",a),alert("Failed to fetch teams")}finally{g.value=!1}},V=async()=>{try{const a=await u.get("/admin/teams/managers/list");j.value=a.data}catch(a){console.error("Error fetching managers:",a)}},A=async()=>{try{const a=await u.get("/admin/users");E.value=a.data.data||a.data}catch(a){console.error("Error fetching users:",a)}},$=a=>{a?(b.value=a,r.value={name:a.name,description:a.description||"",manager_id:a.manager_id}):(b.value=null,r.value={name:"",description:"",manager_id:null}),w.value=!0},M=()=>{w.value=!1,b.value=null},z=async()=>{var a,t;g.value=!0;try{b.value?await u.put(`/admin/teams/${b.value.id}`,r.value):await u.post("/admin/teams",r.value),await h(),M(),r.value={name:"",description:"",manager_id:null}}catch(d){alert(((t=(a=d.response)==null?void 0:a.data)==null?void 0:t.message)||"Error saving team")}finally{g.value=!1}},B=async a=>{var t,d;if(confirm("Are you sure you want to delete this team?"))try{await u.delete(`/admin/teams/${a}`),await h()}catch(s){alert(((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.message)||"Error deleting team")}},F=async a=>{var t;v.value=a,await A(),m.value.selectedMembers=((t=a.members)==null?void 0:t.map(d=>d.id))||[],k.value=!0},C=()=>{k.value=!1,v.value=null,m.value.selectedMembers=[]},U=async()=>{var a,t,d;if(v.value){g.value=!0;try{for(const n of m.value.selectedMembers)await u.put(`/admin/users/${n}`,{team_id:v.value.id});const p=(((a=v.value.members)==null?void 0:a.map(n=>n.id))||[]).filter(n=>!m.value.selectedMembers.includes(n));for(const n of p)await u.put(`/admin/users/${n}`,{team_id:null});await h(),C()}catch(s){alert(((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.message)||"Error updating team members")}finally{g.value=!1}}},I=a=>{const t=m.value.selectedMembers.indexOf(a);t>-1?m.value.selectedMembers.splice(t,1):m.value.selectedMembers.push(a)};return(a,t)=>(l(),o(f,null,[N(O(G),{title:"Team Management"}),N(P,null,{header:D(()=>[e("div",Q,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Team Management ",-1)),e("button",{onClick:t[0]||(t[0]=d=>$()),class:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500"}," Add Team ")])]),default:D(()=>{var d;return[e("div",R,[e("div",W,[g.value&&y.value.length===0?(l(),o("div",X,[...t[5]||(t[5]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1)])])):(l(),o("div",Y,[(l(!0),o(f,null,_(y.value,s=>{var p;return l(),o("div",{key:s.id,class:"bg-white shadow rounded-lg overflow-hidden"},[e("div",Z,[e("div",ee,[e("div",null,[e("h3",te,i(s.name),1),s.description?(l(),o("p",se,i(s.description),1)):x("",!0)]),e("div",ae,[e("button",{onClick:n=>F(s),class:"rounded-md bg-green-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-green-500"}," Manage Members ",8,oe),e("button",{onClick:n=>$(s),class:"rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500"}," Edit ",8,le),e("button",{onClick:n=>B(s.id),class:"rounded-md bg-red-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-red-500"}," Delete ",8,ne)])])]),e("div",ie,[s.manager?(l(),o("div",de,[t[6]||(t[6]=e("span",{class:"font-medium text-gray-700"},"Manager:",-1)),e("span",re,i(s.manager.name)+" ("+i(s.manager.email)+")",1)])):(l(),o("div",ce,"No manager assigned")),e("div",me,[e("h4",ue,"Team Members ("+i(((p=s.members)==null?void 0:p.length)||0)+")",1),s.members&&s.members.length>0?(l(),o("div",ge,[(l(!0),o(f,null,_(s.members,n=>(l(),o("div",{key:n.id,class:"flex items-center justify-between text-sm p-2 bg-gray-50 rounded"},[e("div",null,[e("span",ve,i(n.name),1),e("span",pe,"("+i(n.email)+")",1)]),n.shift_start&&n.shift_end?(l(),o("div",be," Shift: "+i(n.shift_start)+" - "+i(n.shift_end),1)):x("",!0)]))),128))])):(l(),o("p",xe,"No members in this team"))])])])}),128)),y.value.length===0?(l(),o("div",fe,[...t[7]||(t[7]=[e("p",null,'No teams created yet. Click "Add Team" to get started.',-1)])])):x("",!0)]))])]),w.value?(l(),o("div",ye,[e("div",he,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75","aria-hidden":"true",onClick:M}),e("div",_e,[e("div",we,[e("h3",ke,i(b.value?"Edit Team":"Add Team"),1),e("form",{onSubmit:H(z,["prevent"])},[e("div",Me,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700"},"Team Name",-1)),T(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.name=s),type:"text",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[S,r.value.name]])]),e("div",Ce,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),T(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.description=s),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[S,r.value.description]])]),e("div",Te,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700"},"Manager",-1)),T(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.manager_id=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},[t[10]||(t[10]=e("option",{value:null},"No Manager",-1)),(l(!0),o(f,null,_(j.value,s=>(l(),o("option",{key:s.id,value:s.id},i(s.name)+" ("+i(s.email)+") ",9,je))),128))],512),[[J,r.value.manager_id]])]),e("div",{class:"flex justify-end space-x-3"},[e("button",{type:"button",onClick:M,class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"}," Cancel "),t[12]||(t[12]=e("button",{type:"submit",class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700"}," Save ",-1))])],32)])])])])):x("",!0),k.value?(l(),o("div",Ee,[e("div",$e,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75","aria-hidden":"true",onClick:C}),e("div",Ne,[e("div",De,[e("h3",Se," Manage Team Members: "+i((d=v.value)==null?void 0:d.name),1),e("div",Ve,[e("div",Ae,[(l(!0),o(f,null,_(E.value,s=>{var p;return l(),o("div",{key:s.id,onClick:n=>I(s.id),class:K(["flex items-center justify-between p-3 rounded cursor-pointer transition",m.value.selectedMembers.includes(s.id)?"bg-indigo-50 border-2 border-indigo-500":"bg-gray-50 border-2 border-transparent hover:bg-gray-100"])},[e("div",null,[e("div",Be,i(s.name),1),e("div",Fe,i(s.email),1),s.team&&s.team.id!==((p=v.value)==null?void 0:p.id)?(l(),o("div",Ue," Currently in: "+i(s.team.name),1)):x("",!0)]),e("div",Ie,[m.value.selectedMembers.includes(s.id)?(l(),o("div",Le,[...t[13]||(t[13]=[e("svg",{class:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)])])):(l(),o("div",qe))])],10,ze)}),128))])]),e("div",{class:"mt-6 flex justify-end space-x-3"},[e("button",{type:"button",onClick:C,class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"}," Cancel "),e("button",{onClick:U,class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700"}," Save ")])])])])])):x("",!0)]}),_:1})],64))}});export{Ke as default};
