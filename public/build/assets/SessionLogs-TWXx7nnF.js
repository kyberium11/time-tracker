import{d as L,r as g,o as T,w as D,a as i,b,e as U,h as V,f as h,g as e,i as j,m,j as u,F as x,l as w,t as l,v as F,p as k,O as M}from"./app-CSGij_Nf.js";import{_ as P}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-8KIKFyLy.js";const $={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},B={class:"flex items-center gap-2"},O=["disabled"],E=["disabled"],R={class:"mx-auto max-w-7xl py-6 sm:px-6 lg:px-8"},A={class:"rounded-lg bg-white p-4 shadow"},J={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4"},q={class:"space-y-1"},z=["value"],G={class:"space-y-1"},H={class:"space-y-1"},I={class:"mt-6 overflow-x-auto"},K={class:"min-w-full divide-y divide-gray-200 text-sm"},Q={class:"divide-y divide-gray-200"},W={key:0},X={key:1},Y={class:"px-4 py-3 text-gray-900 whitespace-nowrap"},Z={class:"px-4 py-3 text-gray-900"},ee={class:"font-medium"},te={class:"text-xs text-gray-500"},se={class:"px-4 py-3 text-gray-900"},ae={class:"text-xs text-gray-500"},oe={class:"px-4 py-3 text-gray-700 max-w-xs"},le={class:"line-clamp-3 whitespace-pre-wrap"},de={class:"px-4 py-3 text-gray-700 max-w-sm"},re={class:"line-clamp-3 break-words"},ne={key:0,class:"mt-4 flex items-center justify-between text-sm text-gray-600"},ie={class:"flex items-center gap-2"},ue=["disabled"],ce=["disabled"],xe=L({__name:"SessionLogs",setup(ge){const p=g([]),f=g([]),n=g(!1),o=g(null),r=g({user_id:"",start_date:"",end_date:""}),c=async(a=1)=>{var t;n.value=!0;try{const{data:s}=await M.get("/api/admin/session-logs",{params:{...r.value,page:a}});p.value=s.data??[],f.value=((t=s.filters)==null?void 0:t.users)??[],o.value=s.meta??null}catch(s){console.error("Failed to load session logs",s)}finally{n.value=!1}},N=()=>{r.value={user_id:"",start_date:"",end_date:""},c()},y=a=>{o.value&&(a<1||a>o.value.last_page||c(a))},C=a=>a?new Date(a).toLocaleString():"-",S=a=>{if(!a||Object.keys(a).length===0)return"-";const t=a.dataset||{},s=t.taskName||t.task||a.taskName||a.task;if(s)return s;try{const d=JSON.stringify(a);return d.length>120?d.slice(0,117)+"...":d}catch{return"-"}};T(()=>{c()});let v;return D(()=>({...r.value}),()=>{window.clearTimeout(v),v=window.setTimeout(()=>c(),300)},{deep:!0}),(a,t)=>(u(),i(x,null,[b(U(V),{title:"Session Logs"}),b(P,null,{header:h(()=>[e("div",$,[t[6]||(t[6]=e("div",null,[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Session Logs "),e("p",{class:"text-sm text-gray-500"}," Developer-only view of captured user clicks and events. ")],-1)),e("div",B,[e("button",{type:"button",class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:t[0]||(t[0]=s=>{var d;return c(((d=o.value)==null?void 0:d.current_page)??1)}),disabled:n.value},l(n.value?"Refreshing...":"Refresh"),9,O),e("button",{type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:N,disabled:n.value}," Clear Filters ",8,E)])])]),default:h(()=>[e("div",R,[e("div",A,[e("div",J,[e("div",q,[t[8]||(t[8]=e("label",{class:"text-sm font-medium text-gray-700"},"User",-1)),m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.user_id=s),class:"block w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[t[7]||(t[7]=e("option",{value:""},"All users",-1)),(u(!0),i(x,null,w(f.value,s=>(u(),i("option",{key:s.id,value:s.id},l(s.name)+" ("+l(s.role)+") ",9,z))),128))],512),[[F,r.value.user_id]])]),e("div",G,[t[9]||(t[9]=e("label",{class:"text-sm font-medium text-gray-700"},"Start date",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>r.value.start_date=s),class:"block w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[k,r.value.start_date]])]),e("div",H,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-gray-700"},"End date",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=s=>r.value.end_date=s),class:"block w-full rounded-md border-gray-300 text-sm shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[k,r.value.end_date]])])]),e("div",I,[e("table",K,[t[13]||(t[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-medium text-gray-500"},"Timestamp"),e("th",{class:"px-4 py-3 text-left font-medium text-gray-500"},"User"),e("th",{class:"px-4 py-3 text-left font-medium text-gray-500"},"Path"),e("th",{class:"px-4 py-3 text-left font-medium text-gray-500"},"Description"),e("th",{class:"px-4 py-3 text-left font-medium text-gray-500"},"Metadata")])],-1)),e("tbody",Q,[n.value?(u(),i("tr",W,[...t[11]||(t[11]=[e("td",{colspan:"5",class:"px-4 py-6 text-center text-gray-500"}," Loading logs... ",-1)])])):p.value.length===0?(u(),i("tr",X,[...t[12]||(t[12]=[e("td",{colspan:"5",class:"px-4 py-6 text-center text-gray-500"}," No logs found for the selected filters. ",-1)])])):(u(!0),i(x,{key:2},w(p.value,s=>{var d,_;return u(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",Y,l(C(s.created_at)),1),e("td",Z,[e("div",ee,l(((d=s.user)==null?void 0:d.name)??"Unknown"),1),e("div",te,l(((_=s.user)==null?void 0:_.role)??"n/a"),1)]),e("td",se,[e("div",ae,l(s.path||"-"),1)]),e("td",oe,[e("p",le,l(s.description||"-"),1)]),e("td",de,[e("p",re,l(S(s.metadata)),1)])])}),128))])])]),o.value?(u(),i("div",ne,[e("div",null," Page "+l(o.value.current_page)+" of "+l(o.value.last_page)+" ("+l(o.value.total)+" records) ",1),e("div",ie,[e("button",{class:"rounded border border-gray-300 px-3 py-1 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",disabled:o.value.current_page<=1||n.value,onClick:t[4]||(t[4]=s=>y(o.value.current_page-1))}," Previous ",8,ue),e("button",{class:"rounded border border-gray-300 px-3 py-1 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",disabled:o.value.current_page>=o.value.last_page||n.value,onClick:t[5]||(t[5]=s=>y(o.value.current_page+1))}," Next ",8,ce)])])):j("",!0)])])]),_:1})],64))}});export{xe as default};
