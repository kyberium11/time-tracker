import{d as P,r as f,o as B,a as i,b as $,u as R,h as z,e as M,f as e,i as I,g as n,F as b,k as h,t as m,n as L,s as W,l as u,m as p,v as N,j as O,x as G}from"./app-VfKoOC07.js";import{_ as H}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-Ne2mltuJ.js";import{a as x}from"./api-CGQRoDEs.js";const J={class:"flex items-center justify-between"},K={class:"py-12"},Q={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},X={class:"overflow-hidden bg-white shadow sm:rounded-lg"},Y={class:"min-w-full divide-y divide-gray-200"},Z={class:"divide-y divide-gray-200 bg-white"},ee={class:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900"},te={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},se={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ae=["value","onChange"],le=["selected"],oe=["selected"],de=["selected"],ie={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ne={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},re={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},me={key:0,class:"space-y-1 text-xs text-gray-700"},ue={key:1,class:"text-xs text-gray-400 italic"},ce={key:0},pe={key:1},fe={class:"whitespace-nowrap px-6 py-4 text-sm font-medium"},xe=["onClick"],ge=["onClick"],ye=["onClick"],be={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},_e={class:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0"},ve={class:"relative inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg"},he={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},we={class:"text-lg font-medium leading-6 text-gray-900 mb-4"},ke={class:"mb-4"},Ue={class:"mb-4"},Ce={class:"mb-4"},Ve={class:"block text-sm font-medium text-gray-700"},Se=["required"],Ee={class:"mb-4"},$e=["required"],Me={class:"mb-4"},Ne={class:"mb-4"},Te=["value"],qe={class:"mb-4 grid grid-cols-2 gap-4"},Ae={class:"mb-6"},De={class:"flex items-center justify-between"},Fe={class:"mt-3 divide-y divide-gray-100 rounded-md border border-gray-200"},je={class:"w-28 text-sm font-medium text-gray-800"},Pe={class:"flex items-center gap-2 text-sm text-gray-700"},Be=["onUpdate:modelValue"],Re={class:"flex items-center gap-2"},ze=["onUpdate:modelValue","disabled"],Ie=["onUpdate:modelValue","disabled"],Le={class:"mb-4"},Je=P({__name:"Users",setup(We){const U=f([]),g=f(!1),w=f(!1),c=f(null),l=f({name:"",email:"",password:"",password_confirmation:"",role:"employee",team_id:null,shift_start:"",shift_end:"",clickup_user_id:""}),C=[{label:"Sunday",value:0},{label:"Monday",value:1},{label:"Tuesday",value:2},{label:"Wednesday",value:3},{label:"Thursday",value:4},{label:"Friday",value:5},{label:"Saturday",value:6}],_=()=>C.map(a=>({day_of_week:a.value,start_time:"",end_time:"",enabled:!1})),y=f(_()),V=f([]),T=async()=>{try{const a=await x.get("/admin/teams");V.value=a.data}catch(a){console.error("Error fetching teams:",a)}},v=async()=>{g.value=!0;try{const a=await x.get("/admin/users");U.value=a.data.data}catch(a){console.error("Error fetching users:",a),alert("Failed to fetch users")}finally{g.value=!1}},S=a=>{var s,t;y.value=_(),a?(c.value=a,l.value={name:a.name,email:a.email,password:"",password_confirmation:"",role:a.role,team_id:((s=a.team)==null?void 0:s.id)||null,shift_start:a.shift_start||"",shift_end:a.shift_end||"",clickup_user_id:a.clickup_user_id||""},(t=a.shift_schedule)!=null&&t.length&&a.shift_schedule.forEach(o=>{const d=y.value.find(r=>r.day_of_week===o.day_of_week);d&&(d.enabled=!0,d.start_time=o.start_time,d.end_time=o.end_time)})):(c.value=null,l.value={name:"",email:"",password:"",password_confirmation:"",role:"employee",team_id:null,shift_start:"",shift_end:"",clickup_user_id:""}),w.value=!0},k=()=>{w.value=!1,c.value=null,y.value=_()},q=()=>y.value.filter(a=>a.enabled&&a.start_time&&a.end_time).map(a=>({day_of_week:a.day_of_week,start_time:a.start_time,end_time:a.end_time})),A=async()=>{var a,s;g.value=!0;try{const t={...l.value,shift_schedule:q()};c.value?await x.put(`/admin/users/${c.value.id}`,t):await x.post("/admin/users",t),await v(),k(),l.value={name:"",email:"",password:"",password_confirmation:"",role:"employee",team_id:null,shift_start:"",shift_end:"",clickup_user_id:""}}catch(t){alert(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Error saving user")}finally{g.value=!1}},D=async a=>{var s,t;if(confirm("Are you sure you want to delete this user?"))try{await x.delete(`/admin/users/${a}`),await v()}catch(o){alert(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||"Error deleting user")}},F=async(a,s)=>{var t,o;if(confirm(`Are you sure you want to change this user's role to ${s}?`)){g.value=!0;try{await x.put(`/admin/users/${a}`,{role:s}),await v()}catch(d){alert(((o=(t=d.response)==null?void 0:t.data)==null?void 0:o.message)||"Error updating role")}finally{g.value=!1}}},j=async a=>{var s,t,o;try{const r=((s=(await x.post(`/admin/users/${a}/clickup/sync-tasks`)).data)==null?void 0:s.count)??0;alert(`Synced ${r} task(s) from ClickUp.`)}catch(d){alert(((o=(t=d==null?void 0:d.response)==null?void 0:t.data)==null?void 0:o.error)||"Failed to sync tasks")}};B(()=>{v(),T()});const E=a=>{var s;return((s=C.find(t=>t.value===a))==null?void 0:s.label)??"Unknown"};return(a,s)=>(n(),i(b,null,[$(R(z),{title:"User Management"}),$(H,null,{header:M(()=>[e("div",J,[s[11]||(s[11]=e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," User Management ",-1)),e("button",{onClick:s[0]||(s[0]=t=>S()),class:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500"}," Add User ")])]),default:M(()=>[e("div",K,[e("div",Q,[e("div",X,[e("table",Y,[s[12]||(s[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Name "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Email "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Role "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," ClickUp User ID "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Team "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Shift Time "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Actions ")])],-1)),e("tbody",Z,[(n(!0),i(b,null,h(U.value,t=>{var o,d;return n(),i("tr",{key:t.id},[e("td",ee,m(t.name),1),e("td",te,m(t.email),1),e("td",se,[e("select",{value:t.role,onChange:r=>F(t.id,r.target.value),class:L(["inline-flex rounded-full px-3 py-1 text-xs font-semibold leading-5 border-0 cursor-pointer",t.role==="admin"?"bg-purple-600 text-white hover:bg-purple-700":t.role==="manager"?"bg-blue-600 text-white hover:bg-blue-700":"bg-green-600 text-white hover:bg-green-700"])},[e("option",{value:"admin",selected:t.role==="admin"},"Admin",8,le),e("option",{value:"manager",selected:t.role==="manager"},"Manager",8,oe),e("option",{value:"employee",selected:t.role==="employee"},"Employee",8,de)],42,ae)]),e("td",ie,m(t.clickup_user_id||"â€”"),1),e("td",ne,m(((o=t.team)==null?void 0:o.name)||"No team"),1),e("td",re,[(d=t.shift_schedule)!=null&&d.length?(n(),i("div",me,[(n(!0),i(b,null,h(t.shift_schedule,r=>(n(),i("div",{key:`${t.id}-${r.day_of_week}`},m(E(r.day_of_week))+": "+m(r.start_time)+" - "+m(r.end_time),1))),128))])):(n(),i("div",ue,[t.shift_start&&t.shift_end?(n(),i("span",ce,m(t.shift_start)+" - "+m(t.shift_end),1)):(n(),i("span",pe,"Not set"))]))]),e("td",fe,[e("button",{onClick:r=>S(t),class:"rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500"}," Edit ",8,xe),e("button",{onClick:r=>j(t.id),class:"ml-2 rounded-md bg-green-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-green-500"}," Refresh Tasks ",8,ge),e("button",{onClick:r=>D(t.id),class:"ml-2 rounded-md bg-red-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-red-500"}," Delete ",8,ye)])])}),128))])])])])]),w.value?(n(),i("div",be,[e("div",_e,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75","aria-hidden":"true",onClick:k}),e("div",ve,[e("div",he,[e("h3",we,m(c.value?"Edit User":"Add User"),1),e("form",{onSubmit:W(A,["prevent"])},[e("div",ke,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium text-gray-700"},"Name",-1)),u(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>l.value.name=t),type:"text",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[p,l.value.name]])]),e("div",Ue,[s[14]||(s[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),u(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>l.value.email=t),type:"email",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[p,l.value.email]])]),e("div",Ce,[e("label",Ve,m(c.value?"New Password (leave blank to keep current)":"Password"),1),u(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>l.value.password=t),type:"password",required:!c.value,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,8,Se),[[p,l.value.password]])]),e("div",Ee,[s[15]||(s[15]=e("label",{class:"block text-sm font-medium text-gray-700"},"Confirm Password",-1)),u(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>l.value.password_confirmation=t),type:"password",required:!c.value,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,8,$e),[[p,l.value.password_confirmation]])]),e("div",Me,[s[17]||(s[17]=e("label",{class:"block text-sm font-medium text-gray-700"},"Role",-1)),u(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>l.value.role=t),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},[...s[16]||(s[16]=[e("option",{value:"admin"},"Admin",-1),e("option",{value:"manager"},"Manager",-1),e("option",{value:"employee"},"Employee",-1)])],512),[[N,l.value.role]])]),e("div",Ne,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium text-gray-700"},"Team",-1)),u(e("select",{"onUpdate:modelValue":s[6]||(s[6]=t=>l.value.team_id=t),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},[s[18]||(s[18]=e("option",{value:null},"No team",-1)),(n(!0),i(b,null,h(V.value,t=>(n(),i("option",{key:t.id,value:t.id},m(t.name),9,Te))),128))],512),[[N,l.value.team_id]])]),e("div",qe,[e("div",null,[s[20]||(s[20]=e("label",{class:"block text-sm font-medium text-gray-700"},"Shift Start",-1)),u(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>l.value.shift_start=t),type:"time",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[p,l.value.shift_start]])]),e("div",null,[s[21]||(s[21]=e("label",{class:"block text-sm font-medium text-gray-700"},"Shift End",-1)),u(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>l.value.shift_end=t),type:"time",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[p,l.value.shift_end]])])]),e("div",Ae,[e("div",De,[s[22]||(s[22]=e("div",null,[e("p",{class:"text-sm font-medium text-gray-700"},"Weekly Shift Schedule"),e("p",{class:"text-xs text-gray-500"}," Configure day-specific hours. Unchecked days are treated as off. ")],-1)),e("button",{type:"button",class:"text-xs text-indigo-600 hover:text-indigo-800",onClick:s[9]||(s[9]=t=>y.value=_())}," Clear schedule ")]),e("div",Fe,[(n(!0),i(b,null,h(y.value,t=>(n(),i("div",{key:t.day_of_week,class:"flex flex-wrap items-center gap-4 px-4 py-3"},[e("div",je,m(E(t.day_of_week)),1),e("label",Pe,[u(e("input",{type:"checkbox","onUpdate:modelValue":o=>t.enabled=o,class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,8,Be),[[G,t.enabled]]),s[23]||(s[23]=O(" Enable ",-1))]),e("div",Re,[u(e("input",{type:"time","onUpdate:modelValue":o=>t.start_time=o,disabled:!t.enabled,class:"block rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm disabled:bg-gray-100"},null,8,ze),[[p,t.start_time]]),s[24]||(s[24]=e("span",{class:"text-sm text-gray-500"},"to",-1)),u(e("input",{type:"time","onUpdate:modelValue":o=>t.end_time=o,disabled:!t.enabled,class:"block rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm disabled:bg-gray-100"},null,8,Ie),[[p,t.end_time]])])]))),128))])]),e("div",Le,[s[25]||(s[25]=e("label",{class:"block text-sm font-medium text-gray-700"},"ClickUp User ID",-1)),u(e("input",{"onUpdate:modelValue":s[10]||(s[10]=t=>l.value.clickup_user_id=t),type:"text",placeholder:"e.g. 12345678",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[p,l.value.clickup_user_id]]),s[26]||(s[26]=e("p",{class:"mt-1 text-xs text-gray-500"},"Use the member's numeric id from ClickUp.",-1))]),e("div",{class:"flex justify-end space-x-3"},[e("button",{type:"button",onClick:k,class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"}," Cancel "),s[27]||(s[27]=e("button",{type:"submit",class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700"}," Save ",-1))])],32)])])])])):I("",!0)]),_:1})],64))}});export{Je as default};
