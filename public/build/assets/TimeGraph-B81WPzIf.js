import{d as Q,r as m,o as W,c as u,q as X,e as A,b as tt,f as e,u as et,h as st,a as r,j as ot,g as n,t as f,l as U,m as E,i as at,F as h,k as x,C as k}from"./app-Dsr9ISqj.js";import{_ as nt}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-D6zsoWhG.js";import{a as rt}from"./api-CWzYRqvJ.js";const lt={class:"py-6"},it={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},dt={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},ut={class:"border-b border-gray-200 px-6 py-4"},ct={class:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between"},mt={class:"mt-1 text-sm text-gray-500"},ft={key:0},vt={key:1},pt={class:"font-mono"},gt={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-4"},bt={class:"flex flex-wrap items-end gap-4"},ht={class:"flex gap-2"},xt=["disabled"],yt=["disabled"],_t={class:"flex items-center gap-2"},wt=["disabled"],kt={class:"px-2 text-xs font-semibold text-gray-700 border border-gray-200 rounded-md bg-white"},Dt=["disabled"],St={class:"px-6 py-4"},$t={key:0,class:"mb-4 rounded-md bg-red-50 p-4 text-sm text-red-700"},Mt={key:1,class:"flex items-center justify-center py-16"},Tt={key:2,class:"space-y-6"},zt={key:0,class:"py-10 text-center text-sm text-gray-500"},Ct={key:1},Lt={class:"mb-3 flex items-center text-xs text-gray-500"},jt={class:"flex-1"},Bt={class:"flex justify-between text-[11px] font-medium"},Ft={class:"space-y-4"},It={class:"w-36 text-sm font-medium text-gray-700"},Nt={class:"flex-1"},Vt={class:"relative h-12 rounded-md border border-gray-200 bg-gray-50"},At=["title"],Ut={class:"truncate"},y=24,Zt=Q({__name:"TimeGraph",setup(Et){const p=m(!0),v=m(null),D=m([]),S=m("Asia/Manila"),g=m({start:"",end:""}),i=m({startDate:"",endDate:""}),$=s=>s.toISOString().slice(0,10),M=()=>{const s=new Date,t=new Date;t.setDate(t.getDate()-4),i.value.startDate=$(t),i.value.endDate=$(s)},_=async()=>{var s,t;p.value=!0,v.value=null;try{const o={};i.value.startDate&&(o.start_date=i.value.startDate),i.value.endDate&&(o.end_date=i.value.endDate);const{data:a}=await rt.get("/my/time-graph",{params:o});D.value=a.days||[],S.value=a.timezone||"Asia/Manila",g.value={start:a.start_date,end:a.end_date}}catch(o){console.error(o),v.value=((t=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:t.error)||"Unable to load time graph data. Please try again."}finally{p.value=!1}},H=()=>{if(i.value.startDate&&i.value.endDate){const s=new Date(i.value.startDate),t=new Date(i.value.endDate);if(t<s){v.value="End date must be on or after the start date.";return}if((t.getTime()-s.getTime())/(1e3*60*60*24)>30){v.value="Please limit the range to 31 days or less.";return}}_()},O=()=>{M(),_()};W(()=>{M(),_()});const T=s=>{let t=s;for(;t<0;)t+=24;for(;t>=24;)t-=24;return t},z=(s,t)=>{if(t-s>=24)return[{start:0,end:24}];const a=T(s);let l=T(t);return t-s<=0?[{start:a,end:24},{start:0,end:l}]:(l<=a&&t>s&&(l+=24),l>24?[{start:a,end:24},{start:0,end:l-24}]:[{start:a,end:l}])},C=[4,2,1,.5],b=m(1),L=u(()=>b.value>0),j=u(()=>b.value<C.length-1),R=()=>{L.value&&(b.value-=1)},Z=()=>{j.value&&(b.value+=1)},B=u(()=>C[b.value]),G=u(()=>{const s=B.value;return s>=1?`${s} hr`:`${Math.round(s*60)} min`}),w=s=>{const t=(s%24+24)%24,o=Math.floor(t),a=Math.round(t%1*60),l=o>=12?"PM":"AM",d=(o+11)%12+1,c=a===0?"00":a.toString().padStart(2,"0");return`${d}:${c} ${l}`},F=u(()=>{const s=[],t=B.value;for(let o=0;o<=y;o+=t)s.push({label:w(o),value:o});return s}),P=s=>{const t=Math.round(s*3600),o=Math.floor(t/3600),a=Math.floor(t%3600/60),l=t%60,d=c=>c<10?`0${c}`:`${c}`;return`${d(o)}:${d(a)}:${d(l)}`},I=u(()=>D.value.map(s=>{const t=s.shift?z(s.shift.start_hour,s.shift.end_hour):[],o=s.tasks.flatMap(a=>z(a.start_hour,a.end_hour).map(d=>{const c=d.end-d.start,J=w(d.start),K=w(d.end);return{...d,title:a.title,tooltip:`${J} - ${K} (Total Time: ${P(c)})`}}));return{...s,shiftSegments:t,taskSegments:o}})),N=s=>{const t=(s.end-s.start)/y*100;return{left:`${s.start/y*100}%`,width:`${Math.max(t,0)}%`}},V=u(()=>{if(!g.value.start||!g.value.end)return"";const s=new Date(g.value.start),t=new Date(g.value.end),o={month:"long",day:"numeric",year:"numeric"};return`${s.toLocaleDateString(void 0,o)} → ${t.toLocaleDateString(void 0,o)}`}),q=u(()=>I.value.some(s=>s.shiftSegments.length>0||s.taskSegments.length>0)),Y=u(()=>F.value.map(s=>({...s,style:{left:`${s.value/y*100}%`}})));return(s,t)=>(n(),X(nt,null,{header:A(()=>[...t[2]||(t[2]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Time Graph ",-1)])]),default:A(()=>[tt(et(st),{title:"Time Graph"}),e("div",lt,[e("div",it,[e("div",dt,[e("div",ut,[e("div",ct,[e("div",null,[t[4]||(t[4]=e("h3",{class:"text-lg font-medium text-gray-900"}," Shift and Task Schedule ",-1)),e("p",mt,[V.value?(n(),r("span",ft,f(V.value),1)):(n(),r("span",vt,"Last 5 days")),t[3]||(t[3]=ot(" · Timezone: ",-1)),e("span",pt,f(S.value),1)])]),e("div",gt,[e("div",bt,[e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Start Date ",-1)),U(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>i.value.startDate=o),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[E,i.value.startDate]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," End Date ",-1)),U(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>i.value.endDate=o),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[E,i.value.endDate]])]),e("div",ht,[e("button",{type:"button",class:"inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",onClick:H,disabled:p.value}," Apply ",8,xt),e("button",{type:"button",class:"inline-flex items-center rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:O,disabled:p.value}," Reset ",8,yt)])]),e("div",_t,[t[9]||(t[9]=e("span",{class:"text-xs font-medium text-gray-500"},"Time Unit",-1)),e("button",{type:"button",class:"inline-flex h-8 w-8 items-center justify-center rounded-md border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 disabled:opacity-40",onClick:R,disabled:!L.value,"aria-label":"Zoom out"},[...t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 12h14"})],-1)])],8,wt),e("span",kt,f(G.value),1),e("button",{type:"button",class:"inline-flex h-8 w-8 items-center justify-center rounded-md border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 disabled:opacity-40",onClick:Z,disabled:!j.value,"aria-label":"Zoom in"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 5v14m-7-7h14"})],-1)])],8,Dt)])])])]),e("div",St,[v.value?(n(),r("div",$t,f(v.value),1)):at("",!0),p.value?(n(),r("div",Mt,[...t[10]||(t[10]=[e("div",{class:"inline-block h-10 w-10 animate-spin rounded-full border-b-2 border-indigo-600"},null,-1)])])):(n(),r("div",Tt,[q.value?(n(),r("div",Ct,[e("div",Lt,[t[11]||(t[11]=e("div",{class:"w-36"},null,-1)),e("div",jt,[e("div",Bt,[(n(!0),r(h,null,x(F.value,o=>(n(),r("span",{key:o.value},f(o.label),1))),128))])])]),e("div",Ft,[(n(!0),r(h,null,x(I.value,o=>(n(),r("div",{key:o.date,class:"flex items-center gap-4"},[e("div",It,f(o.label),1),e("div",Nt,[e("div",Vt,[(n(!0),r(h,null,x(Y.value,a=>(n(),r("div",{key:a.value,class:"absolute inset-y-0 border-l border-gray-200 last:border-r-0",style:k(a.style)},null,4))),128)),(n(!0),r(h,null,x(o.shiftSegments,(a,l)=>(n(),r("div",{key:`shift-${o.date}-${l}`,class:"absolute inset-y-3 rounded-md bg-sky-200/70 border border-sky-400",style:k(N(a))},null,4))),128)),(n(!0),r(h,null,x(o.taskSegments,(a,l)=>(n(),r("div",{key:`task-${o.date}-${l}`,class:"absolute inset-1 rounded-md bg-emerald-400 border border-emerald-600 text-[11px] font-medium text-emerald-900 flex items-center justify-center px-2 shadow",style:k(N(a)),title:a.tooltip},[e("span",Ut,f(a.title),1)],12,At))),128))])])]))),128))])])):(n(),r("div",zt," No shift or task data for this period. ")),t[12]||(t[12]=e("div",{class:"flex items-center gap-4 text-sm text-gray-600"},[e("div",{class:"flex items-center gap-2"},[e("span",{class:"inline-block h-3 w-6 rounded-sm bg-sky-400 border border-sky-600"}),e("span",null,"Shift")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"inline-block h-3 w-6 rounded-sm bg-emerald-500 border border-emerald-700"}),e("span",null,"Task")])],-1))]))])])])])]),_:1}))}});export{Zt as default};
