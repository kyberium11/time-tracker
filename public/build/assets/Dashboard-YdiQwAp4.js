import{_ as vt}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-Cq63Oy31.js";import{d as ht,r as y,q as _,o as gt,z as mt,c as n,a as Q,u as _t,h as kt,w as X,b as e,e as D,t as l,f as i,n as H,k as ft,F as M,i as E}from"./app-GduDMQx3.js";import{a as h}from"./api-5d8fsRbc.js";const wt={class:"py-12"},bt={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},Tt={class:"mb-6 grid gap-4 md:grid-cols-3"},Ct={class:"overflow-hidden bg-white shadow sm:rounded-lg"},Dt={class:"px-4 py-5 sm:p-6"},Mt={class:"mt-2 text-3xl font-bold text-gray-900"},$t={class:"text-xs text-gray-500"},Bt={key:0,class:"mt-4 flex flex-wrap gap-2"},It=["disabled"],Et=["disabled"],St={class:"overflow-hidden bg-white shadow sm:rounded-lg"},Ot={class:"px-4 py-5 sm:p-6"},Nt={key:0,class:"mt-2"},Lt={class:"text-2xl font-bold text-gray-900 mt-1"},zt={key:1,class:"mt-2 text-sm text-gray-500"},Pt={class:"overflow-hidden bg-white shadow sm:rounded-lg"},jt={class:"px-4 py-5 sm:p-6"},At={class:"mt-2 text-3xl font-bold text-gray-900"},Rt={key:0,class:"mb-6 overflow-hidden bg-white shadow sm:rounded-lg"},Ut={class:"px-4 py-5 sm:p-6"},Vt={class:"overflow-x-auto"},Ft={class:"min-w-full divide-y divide-gray-200"},Ht={class:"divide-y divide-gray-200 bg-white"},Wt={class:"whitespace-nowrap px-6 py-4 text-sm text-indigo-600"},qt=["onClick"],Gt={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},Jt={class:"flex items-center space-x-2"},Kt=["onClick","disabled","aria-label"],Qt={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-4 w-4"},Xt={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-4 w-4"},Yt={key:1,class:"mb-6 overflow-hidden bg-white shadow sm:rounded-lg"},Zt={class:"overflow-hidden bg-white shadow sm:rounded-lg"},te={class:"px-4 py-5 sm:p-6"},ee={key:0,class:"text-center py-8 text-gray-500"},se={key:1,class:"overflow-x-auto"},ae={class:"min-w-full divide-y divide-gray-200"},oe={class:"divide-y divide-gray-200 bg-white"},ne={class:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900"},le={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ie={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},re={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},de={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ce={class:"flex items-center space-x-2"},ue=["disabled"],xe=["disabled"],pe=["disabled"],ye=["disabled"],ve={class:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900"},he={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ge={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},me={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},_e={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ke={class:"flex items-center space-x-2"},fe=["onClick","disabled"],we=["disabled"],be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Te={class:"w-full max-w-2xl rounded-lg bg-white shadow-lg"},Ce={class:"flex items-center justify-between border-b px-4 py-3"},De={class:"p-4"},Me={key:0,class:"text-gray-500 text-sm"},$e={key:1,class:"overflow-x-auto"},Be={class:"min-w-full divide-y divide-gray-200"},Ie={class:"divide-y divide-gray-200 bg-white"},Ee={class:"px-4 py-2 text-sm text-gray-900"},Se={class:"px-4 py-2 text-sm text-gray-700"},Oe={class:"px-4 py-2 text-sm text-gray-700"},Ne={class:"px-4 py-2 text-sm text-gray-700"},Le={class:"px-4 py-2 text-sm text-gray-900"},ze={class:"px-4 py-2 text-sm text-gray-700"},Pe={class:"px-4 py-2 text-sm text-gray-700"},je={class:"px-4 py-2 text-sm text-gray-700"},Ae={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Re={class:"w-full max-w-lg rounded-lg bg-white shadow-lg"},Ue={class:"flex items-center justify-between border-b px-4 py-3"},Ve={key:0,class:"p-4 text-sm text-gray-700"},Fe={class:"font-medium mb-1"},He={class:"mb-2"},We={key:0,class:"mb-2"},qe=["href"],Ge={key:1,class:"prose max-w-none"},Ye=ht({__name:"Dashboard",setup(Je){const d=y(null),c=y(!1),b=y(""),T=y(new Date),A=y("employee"),w=y([]),S=y(null),x=y(null),O=y(!1),W=y([]),$=y([]),k=y(null),N=y(!1);let R=null;const p=_(()=>{var s,t;return!!((s=d.value)!=null&&s.clock_in)&&!((t=d.value)!=null&&t.clock_out)}),m=_(()=>{var s,t;return!!((s=d.value)!=null&&s.break_start)&&!((t=d.value)!=null&&t.break_end)}),Y=_(()=>{var s,t;return((s=d.value)==null?void 0:s.lunch_start)&&!((t=d.value)!=null&&t.lunch_end)}),f=s=>s?(typeof s=="string"?new Date(s):s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"--",L=(s,t)=>{if(!s||!t)return"--";const o=new Date(s),u=new Date(t).getTime()-o.getTime(),v=Math.floor(u/36e5),j=Math.floor(u%36e5/6e4),a=Math.floor(u%6e4/1e3);return`${v}h ${j}m ${a}s`},U=_(()=>{const s=[];if(!d.value)return s;const t=d.value;return s.push({type:"Clock In",start:t.clock_in||null,end:null,duration:"--",status:t.clock_in?"Completed":"Not started"}),(t.break_start||t.break_end)&&s.push({type:"Break",start:t.break_start||null,end:t.break_end||null,duration:t.break_start&&t.break_end?L(t.break_start,t.break_end):t.break_start?"In progress":"--",status:t.break_start&&t.break_end?"Completed":t.break_start?"Active":"Scheduled"}),(t.lunch_start||t.lunch_end)&&s.push({type:"Lunch",start:t.lunch_start||null,end:t.lunch_end||null,duration:t.lunch_start&&t.lunch_end?L(t.lunch_start,t.lunch_end):t.lunch_start?"In progress":"--",status:t.lunch_start&&t.lunch_end?"Completed":t.lunch_start?"Active":"Scheduled"}),t.clock_out&&s.push({type:"Clock Out",start:t.clock_out||null,end:null,duration:"--",status:t.clock_out?"Completed":"Pending"}),s});gt(()=>{B(),Z(),I(),P(),R=window.setInterval(()=>{T.value=new Date},1e3)}),mt(()=>{R&&window.clearInterval(R)});const B=async()=>{try{const s=await h.get("/time-entries/current");d.value=s.data,rt()}catch(s){d.value=null,b.value="No entry today",console.error("Error fetching current entry:",s)}},Z=async()=>{var s;try{const o=(((s=(await h.get("/admin/users")).data)==null?void 0:s.data)||[]).find(r=>(r==null?void 0:r.id)&&(r==null?void 0:r.email));o!=null&&o.role&&(A.value=o.role)}catch{}},I=async()=>{try{const s=await h.get("/my/tasks");w.value=s.data,w.value.length&&S.value===null&&(S.value=w.value[0].id),p.value&&x.value===null&&w.value.length&&(x.value=w.value[0].id)}catch{}},V=async()=>{try{await J()}catch{}},F=async()=>{try{await dt()}catch{}},q=async()=>{try{await ct()}catch{}},z=async()=>{try{await ut()}catch{}},P=async()=>{try{const s=await h.get("/tasks/today-entries");$.value=s.data||[]}catch{$.value=[]}},G=async s=>{try{const t=await h.get(`/tasks/${s}/sync`);k.value=t.data,N.value=!0}catch{N.value=!1}},tt=async()=>{if(m.value){await z();return}p.value?await F():await V()},et=async()=>{if(x.value){alert("Pause or stop the running task first.");return}m.value?await z():(p.value||await V(),await q())},C=s=>s<10?`0${s}`:`${s}`,st=_(()=>{var s,t;return m.value&&((s=d.value)!=null&&s.break_start)?new Date(d.value.break_start):p.value&&((t=d.value)!=null&&t.clock_in)?new Date(d.value.clock_in):null}),at=_(()=>{const s=$.value.find(t=>t.clock_in&&!t.clock_out);return s?new Date(s.clock_in):null}),ot=_(()=>{const s=st.value;if(!s)return"00:00:00";const t=T.value.getTime()-s.getTime(),o=Math.max(0,Math.floor(t/1e3)),r=Math.floor(o/3600),u=Math.floor(o%3600/60),v=o%60;return`${C(r)}:${C(u)}:${C(v)}`}),nt=_(()=>{const s=at.value;if(!s)return"00:00:00";const t=T.value.getTime()-s.getTime(),o=Math.max(0,Math.floor(t/1e3)),r=Math.floor(o/3600),u=Math.floor(o%3600/60),v=o%60;return`${C(r)}:${C(u)}:${C(v)}`}),lt=_(()=>{const s=d.value;if(!s||!s.clock_in)return 0;const t=new Date(s.clock_in),o=s.clock_out?new Date(s.clock_out):T.value;let r=Math.max(0,Math.floor((o.getTime()-t.getTime())/6e4));if(s.break_start&&s.break_end){const u=new Date(s.break_start),v=new Date(s.break_end);r-=Math.max(0,Math.floor((v.getTime()-u.getTime())/6e4))}else if(s.break_start&&!s.break_end){const u=new Date(s.break_start);r-=Math.max(0,Math.floor((T.value.getTime()-u.getTime())/6e4))}if(s.lunch_start&&s.lunch_end){const u=new Date(s.lunch_start),v=new Date(s.lunch_end);r-=Math.max(0,Math.floor((v.getTime()-u.getTime())/6e4))}else if(s.lunch_start&&!s.lunch_end){const u=new Date(s.lunch_start);r-=Math.max(0,Math.floor((T.value.getTime()-u.getTime())/6e4))}return(Math.max(0,r)/60).toFixed(2)}),it=async()=>{try{O.value=!0,W.value=[d.value].filter(Boolean)}catch{O.value=!0,W.value=[]}},rt=()=>{!d.value||!d.value.clock_in?b.value="Not clocked in":d.value.clock_out?b.value="Clocked out":Y.value?b.value="On lunch":m.value?b.value="On break":b.value="Clocked in"},J=async s=>{var t,o;c.value=!0;try{const r={};typeof s=="number"?r.task_id=s:typeof S.value=="number"&&(r.task_id=S.value),await h.post("/time-entries/clock-in",r),await B(),await I()}catch(r){alert(((o=(t=r.response)==null?void 0:t.data)==null?void 0:o.message)||"Error clocking in")}finally{c.value=!1}},dt=async()=>{var s,t;c.value=!0;try{if(x.value){alert("Pause or stop the running task first."),c.value=!1;return}await h.post("/time-entries/clock-out"),await B(),await I()}catch(o){alert(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||"Error clocking out")}finally{c.value=!1}},ct=async()=>{var s,t;c.value=!0;try{await h.post("/time-entries/break-start"),await B(),await I()}catch(o){alert(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||"Error starting break")}finally{c.value=!1}},ut=async()=>{var s,t;c.value=!0;try{await h.post("/time-entries/break-end"),await B(),await I()}catch(o){alert(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||"Error ending break")}finally{c.value=!1}},K=async s=>{if(!p.value){alert("Please Time In first before starting a task.");return}if(m.value&&await z(),p.value&&x.value&&x.value!==s)try{await h.post("/tasks/stop")}catch{}await J(s),x.value=s,await P()},xt=async()=>{try{await h.post("/tasks/stop")}catch{}x.value=null,await P()},pt=async()=>{if(p.value){try{await h.post("/tasks/stop")}catch{await F()}x.value=null,await P()}};return(s,t)=>(i(),n(M,null,[Q(_t(kt),{title:"Dashboard"}),Q(vt,null,{header:X(()=>[...t[4]||(t[4]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Time Tracker Dashboard ",-1)])]),default:X(()=>{var o,r,u,v,j;return[e("div",wt,[e("div",bt,[e("div",Tt,[e("div",Ct,[e("div",Dt,[t[5]||(t[5]=e("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"},"Work Day Timer",-1)),e("p",Mt,l(ot.value),1),e("p",$t,l(m.value?"On Break":p.value?"Working":"Idle"),1),A.value!=="admin"?(i(),n("div",Bt,[e("button",{onClick:tt,disabled:c.value,class:H(["rounded-md px-3 py-1.5 text-xs font-semibold text-white",p.value?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"])},l(p.value?"Time Out":"Time In"),11,It),e("button",{onClick:et,disabled:c.value,class:H(["rounded-md px-3 py-1.5 text-xs font-semibold text-white",m.value?"bg-orange-600 hover:bg-orange-700":"bg-yellow-600 hover:bg-yellow-700"])},l(m.value?"Break Out":"Break In"),11,Et)])):D("",!0)])]),e("div",St,[e("div",Ot,[t[6]||(t[6]=e("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"},"Running Task",-1)),x.value?(i(),n("div",Nt,[e("button",{onClick:t[0]||(t[0]=a=>G(x.value)),class:"text-indigo-600 hover:underline text-sm"},l(((o=w.value.find(a=>a.id===x.value))==null?void 0:o.title)||"#"+x.value),1),e("p",Lt,l(nt.value),1)])):(i(),n("div",zt,"No task running"))])]),e("div",Pt,[e("div",jt,[t[9]||(t[9]=e("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"},"Daily Logs",-1)),e("p",At,[ft(l(lt.value),1),t[7]||(t[7]=e("span",{class:"text-sm font-normal text-gray-500"}," / 8 Hours",-1))]),e("div",{class:"mt-4 flex space-x-2"},[e("button",{onClick:it,class:"rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-indigo-700"},"Daily Logs"),t[8]||(t[8]=e("button",{class:"rounded-md bg-yellow-500 px-3 py-1.5 text-xs font-semibold text-white hover:bg-yellow-600"},"Send Report",-1))])])])]),A.value!=="admin"?(i(),n("div",Rt,[e("div",Ut,[t[13]||(t[13]=e("div",{class:"flex items-center justify-between mb-3"},[e("h3",{class:"text-lg font-medium leading-6 text-gray-900"},"My Tasks")],-1)),e("div",Vt,[e("table",Ft,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Task"),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Actions")])],-1)),e("tbody",Ht,[(i(!0),n(M,null,E(w.value,a=>(i(),n("tr",{key:a.id},[e("td",Wt,[e("button",{onClick:g=>G(a.id),class:"hover:underline"},l(a.title),9,qt)]),e("td",Gt,[e("div",Jt,[e("button",{onClick:g=>x.value===a.id?xt():K(a.id),disabled:c.value,class:H(["rounded-full p-2 text-white",x.value===a.id?"bg-yellow-600 hover:bg-yellow-700":"bg-green-600 hover:bg-green-700"]),"aria-label":x.value===a.id?"Pause":"Play"},[x.value!==a.id?(i(),n("svg",Qt,[...t[10]||(t[10]=[e("path",{d:"M8 5v14l11-7z"},null,-1)])])):(i(),n("svg",Xt,[...t[11]||(t[11]=[e("path",{d:"M6 5h4v14H6zM14 5h4v14h-4z"},null,-1)])]))],10,Kt)])])]))),128))])])])])])):(i(),n("div",Yt,[...t[14]||(t[14]=[e("div",{class:"px-4 py-5 sm:p-6 text-sm text-gray-600"}," Admin view: see current time above and the real-time events table below. ",-1)])])),e("div",Zt,[e("div",te,[t[16]||(t[16]=e("h3",{class:"text-lg font-medium leading-6 text-gray-900 mb-4"},"Today's Time Events",-1)),U.value.length===0?(i(),n("div",ee," No time entries recorded today. Clock in to start tracking time. ")):(i(),n("div",se,[e("table",ae,[t[15]||(t[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Event Type "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Start Time "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," End Time "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Duration "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Status ")])],-1)),e("tbody",oe,[(i(!0),n(M,null,E(U.value,(a,g)=>(i(),n("tr",{key:g},[e("td",ne,l(a.type),1),e("td",le,l(f(a.start)),1),e("td",ie,l(f(a.end)),1),e("td",re,l(a.duration),1),e("td",de,[e("div",ce,[e("button",{onClick:V,disabled:c.value||p.value,class:"rounded-md bg-green-600 px-2 py-1 text-xs font-semibold text-white hover:bg-green-700"},"Time In",8,ue),e("button",{onClick:q,disabled:c.value||!p.value||m.value,class:"rounded-md bg-yellow-600 px-2 py-1 text-xs font-semibold text-white hover:bg-yellow-700"},"Break In",8,xe),e("button",{onClick:z,disabled:c.value||!m.value,class:"rounded-md bg-orange-600 px-2 py-1 text-xs font-semibold text-white hover:bg-orange-700"},"Break Out",8,pe),e("button",{onClick:F,disabled:c.value||!p.value,class:"rounded-md bg-red-600 px-2 py-1 text-xs font-semibold text-white hover:bg-red-700"},"Time Out",8,ye)])])]))),128)),(i(!0),n(M,null,E($.value,a=>{var g;return i(),n("tr",{key:`task-${a.id}`},[e("td",ve," Task: "+l(((g=a.task)==null?void 0:g.title)||`#${a.task_id}`),1),e("td",he,l(f(a.clock_in)),1),e("td",ge,l(f(a.clock_out)),1),e("td",me,l(a.clock_in&&a.clock_out?L(a.clock_in,a.clock_out):a.clock_in?"In progress":"--"),1),e("td",_e,[e("div",ke,[e("button",{onClick:yt=>K(a.task_id),disabled:c.value,class:"rounded-md bg-green-600 px-2 py-1 text-xs font-semibold text-white hover:bg-green-700"},"Play",8,fe),e("button",{onClick:t[1]||(t[1]=yt=>pt()),disabled:c.value,class:"rounded-md bg-red-600 px-2 py-1 text-xs font-semibold text-white hover:bg-red-700"},"Stop",8,we)])])])}),128))])])]))])])]),O.value?(i(),n("div",be,[e("div",Te,[e("div",Ce,[t[17]||(t[17]=e("h4",{class:"text-md font-semibold"},"Daily Logs",-1)),e("button",{onClick:t[2]||(t[2]=a=>O.value=!1),class:"rounded-md bg-gray-100 px-2 py-1 text-xs"},"Close")]),e("div",De,[d.value?(i(),n("div",$e,[e("table",Be,[t[18]||(t[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Event"),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Start Time"),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"End Time"),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Duration")])],-1)),e("tbody",Ie,[(i(!0),n(M,null,E(U.value,(a,g)=>(i(),n("tr",{key:g},[e("td",Ee,l(a.type),1),e("td",Se,l(f(a.start)),1),e("td",Oe,l(f(a.end)),1),e("td",Ne,l(a.duration),1)]))),128)),(i(!0),n(M,null,E($.value,a=>{var g;return i(),n("tr",{key:`modal-task-${a.id}`},[e("td",Le,"Task: "+l(((g=a.task)==null?void 0:g.title)||`#${a.task_id}`),1),e("td",ze,l(f(a.clock_in)),1),e("td",Pe,l(f(a.clock_out)),1),e("td",je,l(a.clock_in&&a.clock_out?L(a.clock_in,a.clock_out):a.clock_in?"In progress":"--"),1)])}),128))])])])):(i(),n("div",Me,"No entry today."))])])])):D("",!0),N.value?(i(),n("div",Ae,[e("div",Re,[e("div",Ue,[t[19]||(t[19]=e("h4",{class:"text-md font-semibold"},"Task Details",-1)),e("button",{onClick:t[3]||(t[3]=a=>N.value=!1),class:"rounded-md bg-gray-100 px-2 py-1 text-xs"},"Close")]),k.value?(i(),n("div",Ve,[e("p",Fe,l((r=k.value.task)==null?void 0:r.title),1),e("p",He,"Status: "+l((u=k.value.task)==null?void 0:u.status),1),(v=k.value.clickup)!=null&&v.url?(i(),n("p",We,[e("a",{href:k.value.clickup.url,target:"_blank",class:"text-indigo-600 hover:underline"},"Open in ClickUp",8,qe)])):D("",!0),(j=k.value.clickup)!=null&&j.text_content?(i(),n("div",Ge,l(k.value.clickup.text_content),1)):D("",!0)])):D("",!0)])])):D("",!0)])]}),_:1})],64))}});export{Ye as default};
