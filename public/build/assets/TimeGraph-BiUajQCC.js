import{d as X,r as m,o as tt,c as u,q as et,e as V,b as st,f as e,u as ot,h as at,a as r,j as nt,g as n,t as f,l as U,m as H,i as rt,C as b,F as x,k as y}from"./app-CIWs87yf.js";import{_ as lt}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-XnNMXvRU.js";import{a as it}from"./api-BjpxMxF2.js";const dt={class:"py-6"},ut={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},ct={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},mt={class:"border-b border-gray-200 px-6 py-4"},ft={class:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between"},vt={class:"mt-1 text-sm text-gray-500"},pt={key:0},gt={key:1},ht={class:"font-mono"},bt={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-4"},xt={class:"flex flex-wrap items-end gap-4"},yt={class:"flex gap-2"},wt=["disabled"],_t=["disabled"],kt={class:"flex items-center gap-2"},Dt=["disabled"],St={class:"px-2 text-xs font-semibold text-gray-700 border border-gray-200 rounded-md bg-white"},$t=["disabled"],Mt={class:"px-6 py-4"},Tt={key:0,class:"mb-4 rounded-md bg-red-50 p-4 text-sm text-red-700"},zt={key:1,class:"flex items-center justify-center py-16"},Ct={key:2,class:"space-y-6"},Lt={key:0,class:"py-10 text-center text-sm text-gray-500"},jt={key:1},Bt={class:"mb-3 flex items-center text-xs text-gray-500"},Ft={class:"flex-1 overflow-x-auto"},At={class:"space-y-4"},Et={class:"w-36 text-sm font-medium text-gray-700"},It={class:"flex-1 overflow-x-auto"},Nt=["title"],Vt={class:"truncate"},w=24,Ut=2,Zt=X({__name:"TimeGraph",setup(Ht){const p=m(!0),v=m(null),S=m([]),$=m("Asia/Manila"),g=m({start:"",end:""}),i=m({startDate:"",endDate:""}),M=s=>s.toISOString().slice(0,10),T=()=>{const s=new Date,t=new Date;t.setDate(t.getDate()-4),i.value.startDate=M(t),i.value.endDate=M(s)},_=async()=>{var s,t;p.value=!0,v.value=null;try{const o={};i.value.startDate&&(o.start_date=i.value.startDate),i.value.endDate&&(o.end_date=i.value.endDate);const{data:a}=await it.get("/my/time-graph",{params:o});S.value=a.days||[],$.value=a.timezone||"Asia/Manila",g.value={start:a.start_date,end:a.end_date}}catch(o){console.error(o),v.value=((t=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:t.error)||"Unable to load time graph data. Please try again."}finally{p.value=!1}},O=()=>{if(i.value.startDate&&i.value.endDate){const s=new Date(i.value.startDate),t=new Date(i.value.endDate);if(t<s){v.value="End date must be on or after the start date.";return}if((t.getTime()-s.getTime())/(1e3*60*60*24)>30){v.value="Please limit the range to 31 days or less.";return}}_()},P=()=>{T(),_()};tt(()=>{T(),_()});const z=s=>{let t=s;for(;t<0;)t+=24;for(;t>=24;)t-=24;return t},C=(s,t)=>{if(t-s>=24)return[{start:0,end:24}];const a=z(s);let l=z(t);return t-s<=0?[{start:a,end:24},{start:0,end:l}]:(l<=a&&t>s&&(l+=24),l>24?[{start:a,end:24},{start:0,end:l-24}]:[{start:a,end:l}])},L=[4,2,1,.5],h=m(1),j=u(()=>h.value>0),B=u(()=>h.value<L.length-1),R=()=>{j.value&&(h.value-=1)},Z=()=>{B.value&&(h.value+=1)},k=u(()=>L[h.value]),G=u(()=>{const s=k.value;return s>=1?`${s} hr`:`${Math.round(s*60)} min`}),q=u(()=>Ut/k.value),F=u(()=>`${Math.max(q.value,1)*100}%`),D=s=>{const t=(s%24+24)%24,o=Math.floor(t),a=Math.round(t%1*60),l=o>=12?"PM":"AM",d=(o+11)%12+1,c=a===0?"00":a.toString().padStart(2,"0");return`${d}:${c} ${l}`},A=u(()=>{const s=[],t=k.value;for(let o=0;o<=w;o+=t)s.push({label:D(o),value:o});return s}),W=s=>{const t=Math.round(s*3600),o=Math.floor(t/3600),a=Math.floor(t%3600/60),l=t%60,d=c=>c<10?`0${c}`:`${c}`;return`${d(o)}:${d(a)}:${d(l)}`},E=u(()=>S.value.map(s=>{const t=s.shift?C(s.shift.start_hour,s.shift.end_hour):[],o=s.tasks.flatMap(a=>C(a.start_hour,a.end_hour).map(d=>{const c=d.end-d.start,K=D(d.start),Q=D(d.end);return{...d,title:a.title,tooltip:`${K} - ${Q} (Total Time: ${W(c)})`}}));return{...s,shiftSegments:t,taskSegments:o}})),I=s=>{const t=(s.end-s.start)/w*100;return{left:`${s.start/w*100}%`,width:`${Math.max(t,0)}%`}},N=u(()=>{if(!g.value.start||!g.value.end)return"";const s=new Date(g.value.start),t=new Date(g.value.end),o={month:"long",day:"numeric",year:"numeric"};return`${s.toLocaleDateString(void 0,o)} → ${t.toLocaleDateString(void 0,o)}`}),Y=u(()=>E.value.some(s=>s.shiftSegments.length>0||s.taskSegments.length>0)),J=u(()=>A.value.map(s=>({...s,style:{left:`${s.value/w*100}%`}})));return(s,t)=>(n(),et(lt,null,{header:V(()=>[...t[2]||(t[2]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Time Graph ",-1)])]),default:V(()=>[st(ot(at),{title:"Time Graph"}),e("div",dt,[e("div",ut,[e("div",ct,[e("div",mt,[e("div",ft,[e("div",null,[t[4]||(t[4]=e("h3",{class:"text-lg font-medium text-gray-900"}," Shift and Task Schedule ",-1)),e("p",vt,[N.value?(n(),r("span",pt,f(N.value),1)):(n(),r("span",gt,"Last 5 days")),t[3]||(t[3]=nt(" · Timezone: ",-1)),e("span",ht,f($.value),1)])]),e("div",bt,[e("div",xt,[e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Start Date ",-1)),U(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>i.value.startDate=o),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[H,i.value.startDate]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," End Date ",-1)),U(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>i.value.endDate=o),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[H,i.value.endDate]])]),e("div",yt,[e("button",{type:"button",class:"inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",onClick:O,disabled:p.value}," Apply ",8,wt),e("button",{type:"button",class:"inline-flex items-center rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:P,disabled:p.value}," Reset ",8,_t)])]),e("div",kt,[t[9]||(t[9]=e("span",{class:"text-xs font-medium text-gray-500"},"Time Unit",-1)),e("button",{type:"button",class:"inline-flex h-8 w-8 items-center justify-center rounded-md border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 disabled:opacity-40",onClick:R,disabled:!j.value,"aria-label":"Zoom out"},[...t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 12h14"})],-1)])],8,Dt),e("span",St,f(G.value),1),e("button",{type:"button",class:"inline-flex h-8 w-8 items-center justify-center rounded-md border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 disabled:opacity-40",onClick:Z,disabled:!B.value,"aria-label":"Zoom in"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 5v14m-7-7h14"})],-1)])],8,$t)])])])]),e("div",Mt,[v.value?(n(),r("div",Tt,f(v.value),1)):rt("",!0),p.value?(n(),r("div",zt,[...t[10]||(t[10]=[e("div",{class:"inline-block h-10 w-10 animate-spin rounded-full border-b-2 border-indigo-600"},null,-1)])])):(n(),r("div",Ct,[Y.value?(n(),r("div",jt,[e("div",Bt,[t[11]||(t[11]=e("div",{class:"w-36"},null,-1)),e("div",Ft,[e("div",{class:"flex justify-between text-[11px] font-medium min-w-full",style:b({width:F.value})},[(n(!0),r(x,null,y(A.value,o=>(n(),r("span",{key:o.value},f(o.label),1))),128))],4)])]),e("div",At,[(n(!0),r(x,null,y(E.value,o=>(n(),r("div",{key:o.date,class:"flex items-center gap-4"},[e("div",Et,f(o.label),1),e("div",It,[e("div",{class:"relative h-12 rounded-md border border-gray-200 bg-gray-50 min-w-full",style:b({width:F.value})},[(n(!0),r(x,null,y(J.value,a=>(n(),r("div",{key:a.value,class:"absolute inset-y-0 border-l border-gray-200 last:border-r-0",style:b(a.style)},null,4))),128)),(n(!0),r(x,null,y(o.shiftSegments,(a,l)=>(n(),r("div",{key:`shift-${o.date}-${l}`,class:"absolute inset-y-3 rounded-md bg-sky-200/70 border border-sky-400",style:b(I(a))},null,4))),128)),(n(!0),r(x,null,y(o.taskSegments,(a,l)=>(n(),r("div",{key:`task-${o.date}-${l}`,class:"absolute inset-1 rounded-md bg-emerald-400 border border-emerald-600 text-[11px] font-medium text-emerald-900 flex items-center justify-center px-2 shadow",style:b(I(a)),title:a.tooltip},[e("span",Vt,f(a.title),1)],12,Nt))),128))],4)])]))),128))])])):(n(),r("div",Lt," No shift or task data for this period. ")),t[12]||(t[12]=e("div",{class:"flex items-center gap-4 text-sm text-gray-600"},[e("div",{class:"flex items-center gap-2"},[e("span",{class:"inline-block h-3 w-6 rounded-sm bg-sky-400 border border-sky-600"}),e("span",null,"Shift")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"inline-block h-3 w-6 rounded-sm bg-emerald-500 border border-emerald-700"}),e("span",null,"Task")])],-1))]))])])])])]),_:1}))}});export{Zt as default};
