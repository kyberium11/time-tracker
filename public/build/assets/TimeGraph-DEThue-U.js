import{d as E,r as u,o as R,c as g,q as U,e as M,b as G,f as s,u as I,h as H,a as l,j as O,g as o,t as c,l as N,m as V,i as P,F as v,k as p,C as b}from"./app-Bg1g1a2t.js";import{_ as q}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-CR1wC4p6.js";import{a as Y}from"./api-JubJnuzD.js";const J={class:"py-6"},K={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},Q={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},W={class:"border-b border-gray-200 px-6 py-4"},X={class:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between"},Z={class:"mt-1 text-sm text-gray-500"},ee={key:0},te={key:1},se={class:"font-mono"},ae={class:"flex flex-wrap items-end gap-4"},ne={class:"flex gap-2"},oe=["disabled"],le=["disabled"],re={class:"px-6 py-4"},ie={key:0,class:"mb-4 rounded-md bg-red-50 p-4 text-sm text-red-700"},de={key:1,class:"flex items-center justify-center py-16"},ue={key:2,class:"space-y-6"},ce={key:0,class:"py-10 text-center text-sm text-gray-500"},me={key:1},fe={class:"mb-3 flex items-center text-xs text-gray-500"},ge={class:"flex-1"},ve={class:"flex justify-between text-[11px] font-medium"},pe={class:"space-y-4"},he={class:"w-36 text-sm font-medium text-gray-700"},ye={class:"flex-1"},be={class:"relative h-12 rounded-md border border-gray-200 bg-gray-50"},xe=["title"],_e={class:"truncate"},h=24,$e=E({__name:"TimeGraph",setup(De){const m=u(!0),d=u(null),x=u([]),_=u("Asia/Manila"),f=u({start:"",end:""}),r=u({startDate:"",endDate:""}),D=t=>t.toISOString().slice(0,10),k=()=>{const t=new Date,e=new Date;e.setDate(e.getDate()-4),r.value.startDate=D(e),r.value.endDate=D(t)},y=async()=>{var t,e;m.value=!0,d.value=null;try{const a={};r.value.startDate&&(a.start_date=r.value.startDate),r.value.endDate&&(a.end_date=r.value.endDate);const{data:n}=await Y.get("/my/time-graph",{params:a});x.value=n.days||[],_.value=n.timezone||"Asia/Manila",f.value={start:n.start_date,end:n.end_date}}catch(a){console.error(a),d.value=((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.error)||"Unable to load time graph data. Please try again."}finally{m.value=!1}},j=()=>{if(r.value.startDate&&r.value.endDate){const t=new Date(r.value.startDate),e=new Date(r.value.endDate);if(e<t){d.value="End date must be on or after the start date.";return}if((e.getTime()-t.getTime())/(1e3*60*60*24)>30){d.value="Please limit the range to 31 days or less.";return}}y()},F=()=>{k(),y()};R(()=>{k(),y()});const w=t=>{let e=t;for(;e<0;)e+=24;for(;e>=24;)e-=24;return e},S=(t,e)=>{if(e-t>=24)return[{start:0,end:24}];const n=w(t);let i=w(e);return e-t<=0?[{start:n,end:24},{start:0,end:i}]:(i<=n&&e>t&&(i+=24),i>24?[{start:n,end:24},{start:0,end:i-24}]:[{start:n,end:i}])},$=g(()=>{const t=[];for(let e=0;e<=h;e+=2){const a=e===0?"12:00 am":`${(e+11)%12+1}:00 ${e>=12?"pm":"am"}`;t.push({label:a,value:e})}return t}),T=g(()=>x.value.map(t=>{const e=t.shift?S(t.shift.start_hour,t.shift.end_hour):[],a=t.tasks.flatMap(n=>S(n.start_hour,n.end_hour).map(B=>({...B,title:n.title})));return{...t,shiftSegments:e,taskSegments:a}})),z=t=>{const e=(t.end-t.start)/h*100;return{left:`${t.start/h*100}%`,width:`${Math.max(e,0)}%`}},C=g(()=>{if(!f.value.start||!f.value.end)return"";const t=new Date(f.value.start),e=new Date(f.value.end),a={month:"long",day:"numeric",year:"numeric"};return`${t.toLocaleDateString(void 0,a)} → ${e.toLocaleDateString(void 0,a)}`}),L=g(()=>T.value.some(t=>t.shiftSegments.length>0||t.taskSegments.length>0)),A=g(()=>$.value.map(t=>({...t,style:{left:`${t.value/h*100}%`}})));return(t,e)=>(o(),U(q,null,{header:M(()=>[...e[2]||(e[2]=[s("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Time Graph ",-1)])]),default:M(()=>[G(I(H),{title:"Time Graph"}),s("div",J,[s("div",K,[s("div",Q,[s("div",W,[s("div",X,[s("div",null,[e[4]||(e[4]=s("h3",{class:"text-lg font-medium text-gray-900"}," Shift and Task Schedule ",-1)),s("p",Z,[C.value?(o(),l("span",ee,c(C.value),1)):(o(),l("span",te,"Last 5 days")),e[3]||(e[3]=O(" · Timezone: ",-1)),s("span",se,c(_.value),1)])]),s("div",ae,[s("div",null,[e[5]||(e[5]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Start Date ",-1)),N(s("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=a=>r.value.startDate=a),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[V,r.value.startDate]])]),s("div",null,[e[6]||(e[6]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," End Date ",-1)),N(s("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>r.value.endDate=a),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[V,r.value.endDate]])]),s("div",ne,[s("button",{type:"button",class:"inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",onClick:j,disabled:m.value}," Apply ",8,oe),s("button",{type:"button",class:"inline-flex items-center rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:F,disabled:m.value}," Reset ",8,le)])])])]),s("div",re,[d.value?(o(),l("div",ie,c(d.value),1)):P("",!0),m.value?(o(),l("div",de,[...e[7]||(e[7]=[s("div",{class:"inline-block h-10 w-10 animate-spin rounded-full border-b-2 border-indigo-600"},null,-1)])])):(o(),l("div",ue,[L.value?(o(),l("div",me,[s("div",fe,[e[8]||(e[8]=s("div",{class:"w-36"},null,-1)),s("div",ge,[s("div",ve,[(o(!0),l(v,null,p($.value,a=>(o(),l("span",{key:a.value},c(a.label),1))),128))])])]),s("div",pe,[(o(!0),l(v,null,p(T.value,a=>(o(),l("div",{key:a.date,class:"flex items-center gap-4"},[s("div",he,c(a.label),1),s("div",ye,[s("div",be,[(o(!0),l(v,null,p(A.value,n=>(o(),l("div",{key:n.value,class:"absolute inset-y-0 border-l border-gray-200 last:border-r-0",style:b(n.style)},null,4))),128)),(o(!0),l(v,null,p(a.shiftSegments,(n,i)=>(o(),l("div",{key:`shift-${a.date}-${i}`,class:"absolute inset-y-1 rounded-md bg-sky-200 border border-sky-400",style:b(z(n))},null,4))),128)),(o(!0),l(v,null,p(a.taskSegments,(n,i)=>(o(),l("div",{key:`task-${a.date}-${i}`,class:"absolute top-2 h-6 rounded-md bg-emerald-400 border border-emerald-600 text-[11px] font-medium text-emerald-900 flex items-center justify-center px-1",style:b(z(n)),title:n.title},[s("span",_e,c(n.title),1)],12,xe))),128))])])]))),128))])])):(o(),l("div",ce," No shift or task data for this period. ")),e[9]||(e[9]=s("div",{class:"flex items-center gap-4 text-sm text-gray-600"},[s("div",{class:"flex items-center gap-2"},[s("span",{class:"inline-block h-3 w-6 rounded-sm bg-sky-400 border border-sky-600"}),s("span",null,"Shift")]),s("div",{class:"flex items-center gap-2"},[s("span",{class:"inline-block h-3 w-6 rounded-sm bg-emerald-500 border border-emerald-700"}),s("span",null,"Task")])],-1))]))])])])])]),_:1}))}});export{$e as default};
